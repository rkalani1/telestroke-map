<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Regional Hospital Stroke Capabilities - WA, SE AK, N ID</title>

    <!-- Leaflet for mapping -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Leaflet MarkerCluster for clustering -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css">
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

    <!-- html2canvas for PDF/image export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            overflow: hidden;
        }

        #map {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100vh;
        }

        .panel {
            position: absolute;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            padding: 24px;
            z-index: 1000;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
        }

        .control-panel {
            top: 20px;
            left: 20px;
            width: 420px;
        }

        .stats-panel {
            top: 20px;
            right: 20px;
            width: 320px;
        }

        .info-panel {
            bottom: 20px;
            left: 20px;
            width: 500px;
            display: none;
        }

        .info-panel.active {
            display: block;
        }

        .app-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .app-header h1 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .app-header p {
            font-size: 11px;
            opacity: 0.9;
        }

        .search-box {
            margin-bottom: 16px;
        }

        .search-box input {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
        }

        .search-box input:focus {
            outline: none;
            border-color: #667eea;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .filter-section {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e5e7eb;
        }

        .filter-section h3 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #374151;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            padding: 6px 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 13px;
        }

        .checkbox-label:hover {
            background: #f3f4f6;
        }

        .checkbox-label input {
            margin-right: 8px;
        }

        .legend-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 12px;
            font-size: 12px;
        }

        .legend-color {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            margin-right: 10px;
            margin-top: 2px;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
            flex-shrink: 0;
        }

        .legend-text {
            flex: 1;
        }

        .legend-text strong {
            display: block;
            color: #1f2937;
            margin-bottom: 2px;
        }

        .legend-text span {
            color: #6b7280;
            font-size: 11px;
        }

        .action-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            width: 100%;
            margin-top: 8px;
            font-weight: 500;
        }

        .action-button:hover {
            background: #2563eb;
        }

        .close-button {
            float: right;
            background: #ef4444;
            color: white;
            border: none;
            padding: 4px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .cert-description {
            background: #f9fafb;
            border-left: 4px solid #667eea;
            padding: 12px;
            margin-bottom: 12px;
            border-radius: 4px;
        }

        .cert-description h4 {
            font-weight: 600;
            margin-bottom: 4px;
            color: #374151;
            font-size: 13px;
        }

        .cert-description p {
            font-size: 11px;
            color: #6b7280;
            line-height: 1.5;
        }

        .disclaimer {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 10px;
            margin-top: 12px;
            border-radius: 4px;
            font-size: 11px;
            color: #92400e;
        }

        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .panel {
                position: relative;
                width: 100% !important;
                max-width: 100%;
                margin: 0;
                border-radius: 0;
                max-height: none;
                transition: transform 0.3s ease;
            }

            .control-panel {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                width: 100% !important;
                padding: 0;
                padding-bottom: 16px;
                border-radius: 0 0 12px 12px;
                max-height: 70vh;
                overflow-y: auto;
                transform: translateY(-100%);
                z-index: 1001;
            }

            .control-panel.mobile-visible {
                transform: translateY(0);
            }

            .stats-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100% !important;
                padding: 0;
                padding-top: 12px;
                padding-bottom: 12px;
                border-radius: 12px 12px 0 0;
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
                max-height: 50vh;
                overflow-y: auto;
                transform: translateY(100%);
                z-index: 1001;
            }

            .stats-panel.mobile-visible {
                transform: translateY(0);
            }

            .panel-content-wrapper {
                padding: 16px;
            }

            .info-panel {
                position: fixed;
                top: 10px;
                left: 10px;
                right: 10px;
                bottom: 10px;
                width: auto !important;
                max-height: calc(100vh - 20px);
                overflow-y: auto;
            }

            #map {
                height: 100vh;
                margin-top: 0;
            }

            body {
                overflow-y: auto;
            }

            .app-header h1 {
                font-size: 16px;
            }

            .app-header p {
                font-size: 10px;
            }

            .stat-card {
                padding: 10px;
                margin-bottom: 0;
            }

            .stat-value {
                font-size: 20px;
            }

            .stat-label {
                font-size: 11px;
            }

            .filter-section {
                margin-bottom: 16px;
                padding-bottom: 16px;
            }

            .action-button {
                padding: 8px 12px;
                font-size: 12px;
                margin-top: 6px;
            }

            .checkbox-label {
                font-size: 12px;
                padding: 4px 6px;
            }

            .legend-item {
                margin-bottom: 8px;
                font-size: 11px;
            }

            /* Modal adjustments for mobile */
            #distance-matrix-modal > div,
            #expansion-modal > div,
            #hospital-detail-modal > div,
            #executive-summary-modal > div,
            #compare-modal > div {
                margin: 10px;
                max-width: calc(100vw - 20px);
                padding: 16px;
                max-height: calc(100vh - 20px);
            }

            /* Make quick filter buttons more compact on mobile */
            .filter-section div[style*="grid-template-columns"] {
                grid-template-columns: 1fr 1fr !important;
            }

            /* Mobile toggle buttons */
            .mobile-toggle-btn {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
                position: fixed;
                padding: 12px 20px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border: none;
                font-weight: 600;
                cursor: pointer;
                font-size: 14px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                z-index: 1002;
                border-radius: 8px;
                transition: all 0.3s ease;
            }

            .mobile-toggle-btn:active {
                transform: scale(0.95);
            }

            #toggle-filters-btn {
                top: 10px;
                left: 10px;
            }

            #toggle-stats-btn {
                bottom: 10px;
                right: 10px;
            }

            .mobile-toggle-icon {
                font-size: 18px;
                line-height: 1;
            }

            .mobile-close-btn {
                display: block !important;
                width: 100%;
                padding: 10px;
                background: #ef4444;
                color: white;
                border: none;
                font-weight: 600;
                cursor: pointer;
                font-size: 14px;
                text-align: center;
                border-radius: 0;
                margin: 0;
                position: sticky;
                top: 0;
                z-index: 10;
            }

            .control-panel .mobile-close-btn {
                border-radius: 0 0 8px 8px;
            }

            .stats-panel .mobile-close-btn {
                border-radius: 8px 8px 0 0;
                grid-column: 1 / -1;
            }

            .stat-card {
                padding: 10px;
                margin-bottom: 0;
            }
        }

        /* Tablet adjustments */
        @media (min-width: 769px) and (max-width: 1024px) {
            .control-panel {
                width: 360px;
                padding: 20px;
            }

            .stats-panel {
                width: 280px;
                padding: 16px;
            }

            .info-panel {
                width: 450px;
            }
        }

        /* Hide mobile toggle buttons on desktop */
        .mobile-toggle-btn {
            display: none;
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <!-- Mobile Toggle Buttons -->
    <button id="toggle-filters-btn" class="mobile-toggle-btn" onclick="toggleMobilePanel('control')">
        <span class="mobile-toggle-icon">‚öôÔ∏è</span>
        <span>Filters</span>
    </button>
    <button id="toggle-stats-btn" class="mobile-toggle-btn" onclick="toggleMobilePanel('stats')">
        <span class="mobile-toggle-icon">üìä</span>
        <span>Stats</span>
    </button>

    <!-- Control Panel -->
    <div class="panel control-panel">
        <button class="mobile-close-btn" onclick="toggleMobilePanel('control')" style="display: none;">‚úï Close</button>
        <div class="app-header">
            <h1>Regional Hospital Stroke Capabilities</h1>
            <p>Washington, Southeast Alaska, Northern Idaho</p>
        </div>

        <!-- Search Box -->
        <div class="search-box">
            <input
                type="text"
                id="search-input"
                placeholder="Search hospitals by name or city..."
                oninput="filterHospitals()"
            >
        </div>

        <!-- Stroke Certification Filters -->
        <div class="filter-section">
            <h3>
                Stroke Certifications
                <button onclick="clearCertFilters()" style="font-size: 11px; padding: 2px 8px; background: #e5e7eb; border: none; border-radius: 4px; cursor: pointer; margin-left: 8px;">Clear All</button>
            </h3>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-csc" onchange="renderMarkers()">
                <strong>CSC</strong> - Comprehensive Stroke Center
            </label>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-tsc" onchange="renderMarkers()">
                <strong>TSC</strong> - Thrombectomy-Capable
            </label>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-psc" onchange="renderMarkers()">
                <strong>PSC</strong> - Primary Stroke Center
            </label>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-asr" onchange="renderMarkers()">
                <strong>ASR/ASRH</strong> - Acute Stroke Ready
            </label>
        </div>

        <!-- Special Designations -->
        <div class="filter-section">
            <h3>
                Special Designations
                <button onclick="clearSpecialFilters()" style="font-size: 11px; padding: 2px 8px; background: #e5e7eb; border: none; border-radius: 4px; cursor: pointer; margin-left: 8px;">Clear All</button>
            </h3>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-uwPartner" onchange="renderMarkers()">
                UW Medicine Telestroke Partners
            </label>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-evt" onchange="renderMarkers()">
                24/7 Thrombectomy (EVT) Capable
            </label>
        </div>

        <!-- Map Legend -->
        <div class="filter-section" style="border-bottom: none;">
            <h3>
                Map Legend
                <button onclick="showCertInfo()" style="font-size: 11px; padding: 2px 8px; background: #e5e7eb; border: none; border-radius: 4px; cursor: pointer;">?</button>
            </h3>
            <div class="legend-item">
                <div class="legend-color" style="background: #dc2626;"></div>
                <div class="legend-text">
                    <strong>CSC - Comprehensive</strong>
                </div>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ea580c;"></div>
                <div class="legend-text">
                    <strong>TSC - Thrombectomy-Capable</strong>
                </div>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #f59e0b;"></div>
                <div class="legend-text">
                    <strong>PSC - Primary</strong>
                </div>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #84cc16;"></div>
                <div class="legend-text">
                    <strong>ASR - Acute Stroke Ready</strong>
                </div>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #3b82f6;"></div>
                <div class="legend-text">
                    <strong>UW Telestroke Partner</strong>
                </div>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #6b7280;"></div>
                <div class="legend-text">
                    <strong>Other Hospitals</strong>
                </div>
            </div>
        </div>

        <!-- Expansion Planning Features -->
        <div class="filter-section">
            <h3>Expansion Planning Tools</h3>
            <button class="action-button" onclick="showNearestAdvancedCenter()">Show Nearest CSC/TSC Distance</button>
            <button class="action-button" onclick="identifyEVTDeserts()">Identify EVT Deserts (>100mi)</button>
            <button class="action-button" onclick="rankExpansionCandidates()">Rank Expansion Candidates</button>
            <button class="action-button" onclick="showDistanceMatrix()">View Distance Matrix</button>
            <button class="action-button" onclick="toggleAdvancedFilters()">Advanced Multi-Criteria Filter</button>
        </div>

        <!-- New Strategic Planning Features -->
        <div class="filter-section">
            <h3>Strategic Planning Features</h3>
            <button class="action-button" onclick="toggleCoverageCircles()">Show Coverage Circles</button>
            <button class="action-button" onclick="toggleUWPartnerNetwork()">Show UW Partner Network</button>
            <button class="action-button" onclick="highlightZeroCapability()">Show Zero-Capability Hospitals</button>
            <button class="action-button" onclick="toggleCSCServiceAreas()">Show CSC Service Areas</button>
            <button class="action-button" onclick="toggleReferralPathways()">Show Referral Pathways</button>
            <button class="action-button" onclick="toggleClusterMarkers()">Toggle Cluster Markers</button>
        </div>

        <!-- Analysis & Reporting -->
        <div class="filter-section">
            <h3>Analysis & Reporting</h3>
            <button class="action-button" onclick="generateExecutiveSummary()">Generate Executive Summary</button>
            <button class="action-button" onclick="exportMapToPNG()">Export Map to PNG</button>
            <button class="action-button" onclick="toggleCompareMode()">Compare Two Hospitals</button>
        </div>

        <!-- Scenario Planning -->
        <div class="filter-section">
            <h3>Scenario Planning</h3>
            <button class="action-button" onclick="startWhatIfScenario()">What-If Scenario Builder</button>
            <button class="action-button" onclick="findOptimalEVTLocation()">Find Optimal EVT Location</button>
        </div>

        <!-- Quick Filters -->
        <div class="filter-section">
            <h3>Quick Filters</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                <button class="action-button" style="padding: 8px 12px; font-size: 12px;" onclick="quickFilter('AK')">Alaska Only</button>
                <button class="action-button" style="padding: 8px 12px; font-size: 12px;" onclick="quickFilter('ID')">Idaho Only</button>
                <button class="action-button" style="padding: 8px 12px; font-size: 12px;" onclick="quickFilter('WA')">Washington Only</button>
                <button class="action-button" style="padding: 8px 12px; font-size: 12px;" onclick="quickFilter('NO_CERT')">No Certification</button>
                <button class="action-button" style="padding: 8px 12px; font-size: 12px;" onclick="quickFilter('UW_ONLY')">UW Partners Only</button>
                <button class="action-button" style="padding: 8px 12px; font-size: 12px;" onclick="quickFilter('EVT_DESERT')">EVT Deserts</button>
                <button class="action-button" style="padding: 8px 12px; font-size: 12px;" onclick="quickFilter('EXPANSION')">Expansion Targets</button>
                <button class="action-button" style="padding: 8px 12px; font-size: 12px; background: #6b7280;" onclick="clearQuickFilters()">Clear Filters</button>
            </div>
        </div>

        <!-- Advanced Filter Panel (Initially Hidden) -->
        <div id="advanced-filters" style="display: none;" class="filter-section">
            <h3>Advanced Filter Criteria</h3>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-not-uw-partner">
                NOT a UW Partner
            </label>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-no-cert">
                NO Stroke Certification
            </label>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-zero-capability">
                Zero-Capability (No cert AND not UW partner)
            </label>
            <div style="margin: 12px 0;">
                <label style="font-size: 13px; font-weight: 600;">Distance from CSC: <span id="csc-distance-value">0</span> miles</label>
                <input type="range" id="filter-csc-distance" min="0" max="200" value="0" style="width: 100%;" oninput="document.getElementById('csc-distance-value').textContent = this.value">
            </div>
            <div style="margin: 12px 0;">
                <label style="font-size: 13px; font-weight: 600;">Distance from EVT: <span id="evt-distance-value">0</span> miles</label>
                <input type="range" id="filter-evt-distance" min="0" max="200" value="0" style="width: 100%;" oninput="document.getElementById('evt-distance-value').textContent = this.value">
            </div>
            <div style="margin: 12px 0;">
                <label style="font-size: 13px; font-weight: 600;">State:</label>
                <select id="filter-state" style="width: 100%; padding: 8px; border-radius: 4px; border: 2px solid #e5e7eb;">
                    <option value="ALL">All States</option>
                    <option value="WA">Washington (WA)</option>
                    <option value="ID">Idaho (ID)</option>
                    <option value="AK">Alaska (AK)</option>
                </select>
            </div>
            <button class="action-button" onclick="applyAdvancedFilters()">Apply Advanced Filters</button>
            <button class="action-button" style="background: #6b7280;" onclick="clearAdvancedFilters()">Clear Advanced Filters</button>
        </div>

        <!-- Action Buttons -->
        <button class="action-button" onclick="exportToCSV()">Export to CSV</button>
        <button class="action-button" onclick="shareCurrentView()">Share Current View (Copy URL)</button>
        <button class="action-button" onclick="resetFilters()">Reset All Filters</button>
    </div>

    <!-- Stats Panel -->
    <div class="panel stats-panel">
        <button class="mobile-close-btn" onclick="toggleMobilePanel('stats')" style="display: none;">‚úï Close</button>
        <div class="stat-card">
            <div class="stat-value" id="stat-total">0</div>
            <div class="stat-label">Total Hospitals Shown</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="stat-csc">0</div>
            <div class="stat-label">Comprehensive (CSC)</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="stat-tsc">0</div>
            <div class="stat-label">Thrombectomy-Capable (TSC)</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="stat-psc">0</div>
            <div class="stat-label">Primary (PSC)</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="stat-asr">0</div>
            <div class="stat-label">Acute Stroke Ready (ASR)</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="stat-uwPartners">0</div>
            <div class="stat-label">UW Medicine Partners</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="stat-evt">0</div>
            <div class="stat-label">24/7 Thrombectomy (EVT)</div>
        </div>

    </div>

    <!-- Info Panel (Certification Explanations) -->
    <div class="panel info-panel" id="info-panel">
        <button class="close-button" onclick="closeInfo()">Close</button>
        <h2 style="font-size: 16px; font-weight: 700; margin-bottom: 16px;">Stroke Certification Levels Explained</h2>

        <div class="cert-description">
            <h4>CSC - Comprehensive Stroke Center</h4>
            <p>Highest level of stroke care. Provides complete range of services including 24/7 neurosurgical coverage, advanced imaging (CT, CTA, MRI, MRA, DSA), endovascular thrombectomy (EVT), neurointensive care, and comprehensive rehabilitation. Can treat the most complex stroke cases including hemorrhagic strokes and aneurysms. Certified by Joint Commission, DNV, or ACHC.</p>
        </div>

        <div class="cert-description">
            <h4>TSC - Thrombectomy-Capable Stroke Center (DNV calls this "PSC+")</h4>
            <p>Advanced stroke care with 24/7 capability to perform mechanical thrombectomy (EVT) for large vessel occlusions. <strong>Must have ALL Primary Stroke Center capabilities PLUS:</strong> interventional neuroradiology team available 24/7, dedicated neurological intensive care unit (neuro-ICU), advanced imaging (CT/CTA/CTP or MRI/MRA), and minimum procedural volumes of 15 mechanical thrombectomies in 12 months OR 30 in 24 months (both per physician and per facility). Can provide endovascular treatment for complex ischemic strokes. Certified by Joint Commission (TSC), DNV (Primary Plus/PSC+), or ACHC (TSC).</p>
        </div>

        <div class="cert-description">
            <h4>PSC - Primary Stroke Center</h4>
            <p>Foundational stroke care certification with necessary staffing, infrastructure, and programs to stabilize and treat most emergent stroke patients. Capabilities include: rapid CT scanning, IV thrombolysis (TNK) administration, dedicated stroke unit or designated stroke beds, 24/7 stroke team availability, standardized treatment protocols, and established transfer agreements to TSC or CSC facilities for patients requiring endovascular thrombectomy or neurosurgery. Certified by Joint Commission, DNV, ACHC, or CIHQ.</p>
        </div>

        <div class="cert-description">
            <h4>ASR/ASRH - Acute Stroke Ready (Hospital)</h4>
            <p>Entry-level stroke certification for hospitals equipped to perform rapid stroke assessments, provide stabilization, and administer IV TNK (tenecteplase). Requirements include: neurology available 24/7 via telemedicine, neurosurgery available within 3-hour transfer, IV thrombolytics available, and established transfer protocols to higher-level stroke centers (PSC, TSC, or CSC) for patients requiring advanced care. Joint Commission uses "ASRH", while DNV uses "ASR". Also certified by ACHC or CIHQ.</p>
        </div>

        <div style="background: #eff6ff; border-left: 4px solid #3b82f6; padding: 12px; margin-bottom: 12px; border-radius: 4px;">
            <h4 style="font-weight: 600; margin-bottom: 4px; color: #1e40af; font-size: 13px;">Understanding EVT (Endovascular Thrombectomy)</h4>
            <p style="font-size: 11px; color: #1e3a8a; line-height: 1.5;">
                <strong>24/7 Thrombectomy Capability</strong> is NOT a certification level‚Äîit's a clinical capability available at TSC and CSC certified hospitals. Mechanical thrombectomy (EVT) is a procedure to remove blood clots causing large vessel occlusions. Hospitals tracked as "EVT-capable" on this map include all TSC and CSC certified facilities, plus any hospitals performing thrombectomy regardless of certification status.
            </p>
        </div>

        <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #e5e7eb; font-size: 12px; color: #6b7280;">
            <strong>National Certifying Bodies:</strong> Four organizations certify stroke centers:
            <ul style="margin: 8px 0; padding-left: 20px; line-height: 1.6;">
                <li><strong>The Joint Commission (TJC)</strong> - Certifies all 4 levels: ASRH, PSC, TSC, CSC</li>
                <li><strong>DNV Healthcare (DNV)</strong> - Certifies all 4 levels: ASR, PSC, PSC+ (Primary Plus, equivalent to TSC), CSC</li>
                <li><strong>Accreditation Commission for Health Care (ACHC)</strong> - Certifies all 4 levels: ASRH, PSC, TSC, CSC</li>
                <li><strong>Center for Improvement in Healthcare Quality (CIHQ)</strong> - Certifies 2 levels: ASRH, PSC</li>
            </ul>
            <p style="margin-top: 8px;"><em>Note: Certification is voluntary. Hospitals undergo rigorous on-site reviews and must meet specific performance standards.</em></p>
        </div>

        <div style="margin-top: 20px; padding-top: 16px; border-top: 2px solid #667eea;">
            <h3 style="font-size: 15px; font-weight: 700; margin-bottom: 12px; color: #374151;">Washington State Stroke Center Categorization</h3>
            <div style="background: #fef3c7; border-left: 4px solid #f59e0b; padding: 12px; margin-bottom: 12px; border-radius: 4px;">
                <p style="font-size: 11px; color: #92400e; line-height: 1.5;">
                    <strong>Important:</strong> Washington State operates a SEPARATE categorization system (Level I, II, III) that is independent from national certifications. Hospitals may have both a national certification (CSC, TSC, PSC, ASR) AND a Washington State designation level. The two systems use different criteria and serve different regulatory purposes.
                </p>
            </div>
            <div style="font-size: 12px; color: #6b7280; line-height: 1.6;">
                <p><strong>Washington State Emergency Cardiac and Stroke (ECS) System:</strong></p>
                <ul style="margin: 8px 0; padding-left: 20px;">
                    <li><strong>Level I:</strong> Highest state designation (similar to CSC capabilities)</li>
                    <li><strong>Level II:</strong> Intermediate designation (similar to TSC/PSC capabilities)</li>
                    <li><strong>Level III:</strong> Basic designation (similar to ASR capabilities)</li>
                </ul>
                <p style="margin-top: 8px;"><em>Note: State categorization is overseen by the Washington Department of Health. Not all hospitals pursue both national certification and state designation. This map shows national certifications.</em></p>
            </div>
        </div>
    </div>

    <!-- Distance Matrix Modal -->
    <div id="distance-matrix-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 2000; overflow: auto;">
        <div style="background: white; margin: 20px auto; max-width: 1200px; border-radius: 12px; padding: 24px; max-height: calc(100vh - 40px); overflow: auto;">
            <button class="close-button" onclick="closeDistanceMatrix()">Close</button>
            <h2 style="font-size: 18px; font-weight: 700; margin-bottom: 16px;">Distance Matrix - All Hospitals</h2>
            <button class="action-button" style="margin-bottom: 12px;" onclick="exportDistanceMatrixToCSV()">Export to CSV</button>
            <div id="distance-matrix-content" style="overflow-x: auto;">
                <!-- Table will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Expansion Candidates Modal -->
    <div id="expansion-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 2000; overflow: auto;">
        <div style="background: white; margin: 20px auto; max-width: 900px; border-radius: 12px; padding: 24px; max-height: calc(100vh - 40px); overflow: auto;">
            <button class="close-button" onclick="closeExpansionRanking()">Close</button>
            <h2 style="font-size: 18px; font-weight: 700; margin-bottom: 8px;">Expansion Candidate Ranking</h2>
            <p style="font-size: 13px; color: #6b7280; margin-bottom: 16px;">Scored by: No certification (+3), Not UW partner (+2), >75mi from CSC/TSC (+2), >100mi from EVT (+1), Has ASR/PSC (-1)</p>
            <div id="expansion-candidates-content">
                <!-- List will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Hospital Detail Card Modal -->
    <div id="hospital-detail-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 2000; overflow: auto;">
        <div style="background: white; margin: 50px auto; max-width: 700px; border-radius: 12px; padding: 24px; max-height: calc(100vh - 100px); overflow: auto;">
            <button class="close-button" onclick="closeHospitalDetail()">Close</button>
            <div id="hospital-detail-content">
                <!-- Content will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Executive Summary Modal -->
    <div id="executive-summary-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 2000; overflow: auto;">
        <div style="background: white; margin: 20px auto; max-width: 900px; border-radius: 12px; padding: 24px; max-height: calc(100vh - 40px); overflow: auto;">
            <button class="close-button" onclick="closeExecutiveSummary()">Close</button>
            <h2 style="font-size: 18px; font-weight: 700; margin-bottom: 16px;">Executive Summary</h2>
            <button class="action-button" style="margin-bottom: 12px;" onclick="copyExecutiveSummary()">Copy to Clipboard</button>
            <button class="action-button" style="margin-bottom: 12px;" onclick="downloadExecutiveSummary()">Download as Text File</button>
            <div id="executive-summary-content" style="font-family: monospace; font-size: 12px; white-space: pre-wrap; background: #f9fafb; padding: 16px; border-radius: 8px; max-height: 60vh; overflow-y: auto;">
                <!-- Content will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Compare Hospitals Modal -->
    <div id="compare-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 2000; overflow: auto;">
        <div style="background: white; margin: 50px auto; max-width: 800px; border-radius: 12px; padding: 24px; max-height: calc(100vh - 100px); overflow: auto;">
            <button class="close-button" onclick="closeCompare()">Close</button>
            <h2 style="font-size: 18px; font-weight: 700; margin-bottom: 16px;">Hospital Comparison</h2>
            <p id="compare-instructions" style="font-size: 13px; color: #6b7280; margin-bottom: 16px;">Click on the first hospital to compare...</p>
            <div id="compare-content">
                <!-- Comparison will be inserted here -->
            </div>
        </div>
    </div>

    <script>
        // Mobile panel toggle functionality
        function toggleMobilePanel(panelType) {
            if (panelType === 'control') {
                const panel = document.querySelector('.control-panel');
                panel.classList.toggle('mobile-visible');
            } else if (panelType === 'stats') {
                const panel = document.querySelector('.stats-panel');
                panel.classList.toggle('mobile-visible');
            }
        }

        // Close panels when clicking on map (mobile only)
        document.addEventListener('DOMContentLoaded', function() {
            const map = document.getElementById('map');
            map.addEventListener('click', function(e) {
                if (window.innerWidth <= 768) {
                    const controlPanel = document.querySelector('.control-panel');
                    const statsPanel = document.querySelector('.stats-panel');

                    // Only close if clicking directly on map, not on markers
                    if (e.target.id === 'map' || e.target.classList.contains('leaflet-container')) {
                        controlPanel.classList.remove('mobile-visible');
                        statsPanel.classList.remove('mobile-visible');
                    }
                }
            });
        });
    </script>
    <script src="complete_hospitals.js"></script>
</body>
</html>
