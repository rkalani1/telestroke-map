<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Regional Hospital Stroke Capabilities - WA, SE AK, N ID</title>

    <!-- Leaflet for mapping -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            overflow: hidden;
        }

        #map {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100vh;
        }

        .panel {
            position: absolute;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            padding: 24px;
            z-index: 1000;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
        }

        .control-panel {
            top: 20px;
            left: 20px;
            width: 420px;
        }

        .stats-panel {
            top: 20px;
            right: 20px;
            width: 320px;
        }

        .info-panel {
            bottom: 20px;
            left: 20px;
            width: 500px;
            display: none;
        }

        .info-panel.active {
            display: block;
        }

        .app-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .app-header h1 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .app-header p {
            font-size: 11px;
            opacity: 0.9;
        }

        .search-box {
            margin-bottom: 16px;
        }

        .search-box input {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
        }

        .search-box input:focus {
            outline: none;
            border-color: #667eea;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .filter-section {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e5e7eb;
        }

        .filter-section h3 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #374151;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            padding: 6px 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 13px;
        }

        .checkbox-label:hover {
            background: #f3f4f6;
        }

        .checkbox-label input {
            margin-right: 8px;
        }

        .legend-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 12px;
            font-size: 12px;
        }

        .legend-color {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            margin-right: 10px;
            margin-top: 2px;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
            flex-shrink: 0;
        }

        .legend-text {
            flex: 1;
        }

        .legend-text strong {
            display: block;
            color: #1f2937;
            margin-bottom: 2px;
        }

        .legend-text span {
            color: #6b7280;
            font-size: 11px;
        }

        .action-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            width: 100%;
            margin-top: 8px;
            font-weight: 500;
        }

        .action-button:hover {
            background: #2563eb;
        }

        .close-button {
            float: right;
            background: #ef4444;
            color: white;
            border: none;
            padding: 4px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .cert-description {
            background: #f9fafb;
            border-left: 4px solid #667eea;
            padding: 12px;
            margin-bottom: 12px;
            border-radius: 4px;
        }

        .cert-description h4 {
            font-weight: 600;
            margin-bottom: 4px;
            color: #374151;
            font-size: 13px;
        }

        .cert-description p {
            font-size: 11px;
            color: #6b7280;
            line-height: 1.5;
        }

        .disclaimer {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 10px;
            margin-top: 12px;
            border-radius: 4px;
            font-size: 11px;
            color: #92400e;
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <!-- Control Panel -->
    <div class="panel control-panel">
        <div class="app-header">
            <h1>Regional Hospital Stroke Capabilities</h1>
            <p>Washington, Southeast Alaska, Northern Idaho</p>
        </div>

        <!-- Search Box -->
        <div class="search-box">
            <input
                type="text"
                id="search-input"
                placeholder="Search hospitals by name or city..."
                oninput="filterHospitals()"
            >
        </div>

        <!-- Stroke Certification Filters -->
        <div class="filter-section">
            <h3>
                Stroke Certifications
                <button onclick="clearCertFilters()" style="font-size: 11px; padding: 2px 8px; background: #e5e7eb; border: none; border-radius: 4px; cursor: pointer; margin-left: 8px;">Clear All</button>
            </h3>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-csc" checked onchange="renderMarkers()">
                <strong>CSC</strong> - Comprehensive Stroke Center
            </label>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-tsc" checked onchange="renderMarkers()">
                <strong>TSC</strong> - Thrombectomy-Capable
            </label>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-psc" checked onchange="renderMarkers()">
                <strong>PSC</strong> - Primary Stroke Center
            </label>
        </div>

        <!-- Special Designations -->
        <div class="filter-section">
            <h3>
                Special Designations
                <button onclick="clearSpecialFilters()" style="font-size: 11px; padding: 2px 8px; background: #e5e7eb; border: none; border-radius: 4px; cursor: pointer; margin-left: 8px;">Clear All</button>
            </h3>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-uwPartner" checked onchange="renderMarkers()">
                UW Medicine Telestroke Partners
            </label>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-evt" checked onchange="renderMarkers()">
                24/7 Thrombectomy (EVT) Capable
            </label>
        </div>

        <!-- Map Legend -->
        <div class="filter-section" style="border-bottom: none;">
            <h3>
                Map Legend
                <button onclick="showCertInfo()" style="font-size: 11px; padding: 2px 8px; background: #e5e7eb; border: none; border-radius: 4px; cursor: pointer;">?</button>
            </h3>
            <div class="legend-item">
                <div class="legend-color" style="background: #dc2626;"></div>
                <div class="legend-text">
                    <strong>CSC - Comprehensive</strong>
                    <span>Highest level, 24/7 EVT</span>
                </div>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ea580c;"></div>
                <div class="legend-text">
                    <strong>TSC - Thrombectomy-Capable</strong>
                    <span>Can perform EVT procedures</span>
                </div>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #f59e0b;"></div>
                <div class="legend-text">
                    <strong>PSC - Primary</strong>
                    <span>Basic stroke care, IV tPA</span>
                </div>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #3b82f6;"></div>
                <div class="legend-text">
                    <strong>UW Telestroke Partner</strong>
                    <span>Connected to UW Medicine network</span>
                </div>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #6b7280;"></div>
                <div class="legend-text">
                    <strong>Other Hospitals</strong>
                    <span>No stroke certification</span>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <button class="action-button" onclick="exportToCSV()">ðŸ“Š Export to CSV</button>
        <button class="action-button" onclick="resetFilters()">ðŸ”„ Reset All Filters</button>
    </div>

    <!-- Stats Panel -->
    <div class="panel stats-panel">
        <div class="stat-card">
            <div class="stat-value" id="stat-total">0</div>
            <div class="stat-label">Total Hospitals Shown</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="stat-csc">0</div>
            <div class="stat-label">Comprehensive (CSC)</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="stat-tsc">0</div>
            <div class="stat-label">Thrombectomy-Capable (TSC)</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="stat-psc">0</div>
            <div class="stat-label">Primary (PSC)</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="stat-uwPartners">0</div>
            <div class="stat-label">UW Medicine Partners</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="stat-evt">0</div>
            <div class="stat-label">24/7 Thrombectomy (EVT)</div>
        </div>

        <div class="disclaimer">
            <strong>Data Sources:</strong><br>
            CMS Hospital Compare (Nov 2024), UW Medicine Telestroke Program, Joint Commission, DNV. All certifications web-verified. Coordinates: OpenStreetMap.
        </div>
    </div>

    <!-- Info Panel (Certification Explanations) -->
    <div class="panel info-panel" id="info-panel">
        <button class="close-button" onclick="closeInfo()">Close</button>
        <h2 style="font-size: 16px; font-weight: 700; margin-bottom: 16px;">Stroke Certification Levels Explained</h2>

        <div class="cert-description">
            <h4>CSC - Comprehensive Stroke Center</h4>
            <p>Highest level of stroke care. Provides complete range of services including 24/7 neurosurgical coverage, advanced imaging, endovascular thrombectomy (EVT), and comprehensive rehabilitation. Can treat the most complex stroke cases. Certified by Joint Commission or DNV.</p>
        </div>

        <div class="cert-description">
            <h4>TSC - Thrombectomy-Capable Stroke Center</h4>
            <p>Advanced stroke care with capability to perform mechanical thrombectomy (EVT) for large vessel occlusions. Has CT/CTA, neuroimaging, and interventional neuroradiology available. Can provide care for complex ischemic strokes requiring endovascular intervention.</p>
        </div>

        <div class="cert-description">
            <h4>PSC - Primary Stroke Center</h4>
            <p>Basic comprehensive acute stroke care with CT scanning, IV thrombolysis (tPA) capability, dedicated stroke unit, and standardized protocols. Focuses on rapid assessment and treatment with established transfer agreements for patients requiring higher-level care (EVT, neurosurgery).</p>
        </div>

        <div class="cert-description">
            <h4>EVT - Endovascular Thrombectomy</h4>
            <p>24/7 mechanical thrombectomy capability for large vessel occlusions. Requires interventional neuroradiology, advanced imaging (CTA/CTP or MRI/MRA), and specialized neurovascular team. All CSC and TSC certified hospitals have EVT capability.</p>
        </div>

        <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #e5e7eb; font-size: 12px; color: #6b7280;">
            <strong>Certifying Bodies:</strong> Joint Commission and DNV are independent accrediting organizations that verify hospitals meet rigorous stroke care standards through on-site reviews and performance metrics.
        </div>
    </div>

    <script src="complete_hospitals.js"></script>
</body>
</html>
