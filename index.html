<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UW Medicine Telestroke Network Map - Strategic Planning Dashboard</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }

        #map {
            height: 100vh;
            width: 100%;
        }

        .control-panel {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            max-width: 350px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .legend {
            position: absolute;
            bottom: 30px;
            right: 10px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            border: 2px solid #333;
        }

        .stats-panel {
            position: absolute;
            top: 10px;
            left: 10px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            min-width: 250px;
        }

        .filter-section {
            margin: 15px 0;
            padding: 10px 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .filter-section:last-child {
            border-bottom: none;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            margin: 8px 0;
            cursor: pointer;
        }

        .checkbox-label input {
            margin-right: 8px;
        }

        /* Custom hospital label styles */
        .hospital-label {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #333;
            border-radius: 3px;
            padding: 2px 6px;
            font-size: 11px;
            font-weight: 600;
            white-space: nowrap;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        .hospital-label-cah { border-color: #3b82f6; color: #3b82f6; }
        .hospital-label-acute { border-color: #6b7280; color: #6b7280; }
        .hospital-label-psc { border-color: #ef4444; color: #ef4444; }
        .hospital-label-csc { border-color: #9333ea; color: #9333ea; }

        /* Print styles */
        @media print {
            .control-panel, .no-print { display: none; }
            #map { height: 100vh; }
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #1f2937;
        }

        .stat-label {
            font-size: 12px;
            color: #6b7280;
            text-transform: uppercase;
        }

        button {
            transition: all 0.2s;
        }

        button:hover {
            transform: translateY(-1px);
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <!-- Statistics Panel -->
    <div class="stats-panel">
        <h3 class="text-lg font-bold mb-4">Network Statistics</h3>
        <div class="space-y-3">
            <div>
                <div class="stat-value" id="total-count">118</div>
                <div class="stat-label">Total Hospitals</div>
            </div>
            <div class="grid grid-cols-2 gap-2 text-sm">
                <div>
                    <div class="font-bold text-blue-600" id="cah-count">51</div>
                    <div class="text-xs text-gray-600">Critical Access</div>
                </div>
                <div>
                    <div class="font-bold text-gray-600" id="acute-count">43</div>
                    <div class="text-xs text-gray-600">Acute Care</div>
                </div>
                <div>
                    <div class="font-bold text-red-600" id="psc-count">7</div>
                    <div class="text-xs text-gray-600">Primary Stroke</div>
                </div>
                <div>
                    <div class="font-bold text-purple-600" id="csc-count">17</div>
                    <div class="text-xs text-gray-600">Comprehensive</div>
                </div>
            </div>
            <div class="pt-3 border-t border-gray-200">
                <div class="text-sm">
                    <div class="flex justify-between mb-1">
                        <span class="text-gray-600">UW Medicine:</span>
                        <span class="font-bold" id="uw-count">0</span>
                    </div>
                    <div class="flex justify-between mb-1">
                        <span class="text-gray-600">Unaffiliated (TBD):</span>
                        <span class="font-bold" id="tbd-count">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Competitor:</span>
                        <span class="font-bold" id="competitor-count">0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Control Panel -->
    <div class="control-panel">
        <h3 class="text-lg font-bold mb-4">Map Controls</h3>

        <!-- Hospital Type Filters -->
        <div class="filter-section">
            <h4 class="font-semibold mb-2 text-sm">Hospital Types</h4>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-cah" checked>
                <span>Critical Access Hospitals (51)</span>
            </label>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-acute" checked>
                <span>Acute Care Hospitals (43)</span>
            </label>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-psc" checked>
                <span>Primary Stroke Centers (7)</span>
            </label>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-csc" checked>
                <span>Comprehensive Stroke Centers (17)</span>
            </label>
        </div>

        <!-- Affiliation Filters -->
        <div class="filter-section">
            <h4 class="font-semibold mb-2 text-sm">Telestroke Affiliation</h4>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-uw" checked>
                <span>UW Medicine Partners</span>
            </label>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-tbd" checked>
                <span>Unaffiliated (TBD)</span>
            </label>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-competitor" checked>
                <span>Competitor Affiliated</span>
            </label>
        </div>

        <!-- Distance Filters -->
        <div class="filter-section">
            <h4 class="font-semibold mb-2 text-sm">Distance from Harborview</h4>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-0-50" checked>
                <span>0-50 miles</span>
            </label>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-50-100" checked>
                <span>50-100 miles</span>
            </label>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-100-150" checked>
                <span>100-150 miles</span>
            </label>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-150-plus" checked>
                <span>150+ miles</span>
            </label>
        </div>

        <!-- Display Options -->
        <div class="filter-section">
            <h4 class="font-semibold mb-2 text-sm">Display Options</h4>
            <label class="checkbox-label">
                <input type="checkbox" id="toggle-labels" checked>
                <span>Show Hospital Labels</span>
            </label>
            <label class="checkbox-label">
                <input type="checkbox" id="toggle-rings" checked>
                <span>Show Distance Rings</span>
            </label>
        </div>

        <!-- Action Buttons -->
        <div class="mt-4 space-y-2">
            <button onclick="resetFilters()" class="w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700">
                Reset All Filters
            </button>
            <button onclick="window.print()" class="w-full bg-gray-600 text-white py-2 px-4 rounded hover:bg-gray-700">
                Print Map
            </button>
        </div>
    </div>

    <!-- Legend -->
    <div class="legend">
        <h4 class="font-semibold mb-2 text-sm">Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #3b82f6;"></div>
            <span class="text-sm">Critical Access Hospital</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #6b7280;"></div>
            <span class="text-sm">Acute Care Hospital</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #ef4444;"></div>
            <span class="text-sm">Primary Stroke Center</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #9333ea;"></div>
            <span class="text-sm">Comprehensive Stroke Center</span>
        </div>
        <div class="mt-3 pt-3 border-t border-gray-300">
            <div class="text-xs text-gray-600">
                <strong>Harborview Medical Center</strong><br>
                Base location for distance rings
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // Harborview Medical Center coordinates
        const HARBORVIEW = {
            lat: 47.6052,
            lng: -122.3204,
            name: 'Harborview Medical Center'
        };

        // Complete hospital data - ALL 118 hospitals
        const hospitals = [
            // === WASHINGTON CRITICAL ACCESS HOSPITALS (39) ===
            { name: 'Columbia County Health System', type: 'CAH', lat: 46.2982, lng: -118.1583, city: 'Dayton', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 1800, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Coulee Medical Center', type: 'CAH', lat: 47.2757, lng: -119.2894, city: 'Grand Coulee', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 3200, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Dayton General Hospital', type: 'CAH', lat: 46.3238, lng: -117.9722, city: 'Dayton', state: 'WA', partner: 'TBD', affiliation: 'TBD', strokeLevel: 'None', edVolume: 1500, helipad: 'No', ct24: 'Yes' },
            { name: 'East Adams Rural Hospital', type: 'CAH', lat: 47.1365, lng: -118.1947, city: 'Ritzville', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 2100, helipad: 'No', ct24: 'Yes' },
            { name: 'Forks Community Hospital', type: 'CAH', lat: 47.9501, lng: -124.3856, city: 'Forks', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 2800, helipad: 'No', ct24: 'Yes' },
            { name: 'Garfield County Public Hospital', type: 'CAH', lat: 46.4207, lng: -117.6272, city: 'Pomeroy', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 1200, helipad: 'No', ct24: 'Yes' },
            { name: 'Jefferson Healthcare', type: 'CAH', lat: 48.1121, lng: -122.7601, city: 'Port Townsend', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 8500, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Klickitat Valley Health', type: 'CAH', lat: 45.8151, lng: -121.5211, city: 'Goldendale', state: 'WA', partner: 'OHSU', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 3400, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Lincoln Hospital', type: 'CAH', lat: 47.6579, lng: -118.3836, city: 'Davenport', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 1800, helipad: 'No', ct24: 'Yes' },
            { name: 'Mid-Valley Hospital', type: 'CAH', lat: 46.4101, lng: -120.5059, city: 'Omak', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 5200, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Mt. Carmel Hospital', type: 'CAH', lat: 46.0907, lng: -118.3430, city: 'Colville', state: 'WA', partner: 'Providence', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 2400, helipad: 'No', ct24: 'Yes' },
            { name: 'Newport Hospital & Health Services', type: 'CAH', lat: 48.1785, lng: -117.0442, city: 'Newport', state: 'WA', partner: 'Providence', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 4100, helipad: 'Yes', ct24: 'Yes' },
            { name: 'North Valley Hospital', type: 'CAH', lat: 48.9217, lng: -119.5103, city: 'Tonasket', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 3600, helipad: 'No', ct24: 'Yes' },
            { name: 'Odessa Memorial Healthcare Center', type: 'CAH', lat: 47.3326, lng: -118.6947, city: 'Odessa', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 1100, helipad: 'No', ct24: 'Yes' },
            { name: 'Pullman Regional Hospital', type: 'CAH', lat: 46.7312, lng: -117.1796, city: 'Pullman', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'ASR', edVolume: 12000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Quincy Valley Medical Center', type: 'CAH', lat: 47.2338, lng: -119.8528, city: 'Quincy', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 6800, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Samaritan Healthcare', type: 'CAH', lat: 47.9562, lng: -119.4211, city: 'Moses Lake', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'ASR', edVolume: 18000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Sunnyside Community Hospital', type: 'CAH', lat: 46.3237, lng: -120.0087, city: 'Sunnyside', state: 'WA', partner: 'Astria', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 9200, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Three Rivers Hospital', type: 'CAH', lat: 48.3640, lng: -119.6550, city: 'Brewster', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 3900, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Summit Pacific Medical Center', type: 'CAH', lat: 46.9540, lng: -123.8356, city: 'Elma', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 7500, helipad: 'No', ct24: 'Yes' },
            { name: 'Toppenish Community Hospital', type: 'CAH', lat: 46.3779, lng: -120.3081, city: 'Toppenish', state: 'WA', partner: 'Virginia Mason', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 8900, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Willapa Harbor Hospital', type: 'CAH', lat: 46.6751, lng: -123.9351, city: 'South Bend', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 2200, helipad: 'No', ct24: 'Yes' },
            { name: 'Othello Community Hospital', type: 'CAH', lat: 46.8260, lng: -119.1753, city: 'Othello', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 5100, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Ocean Beach Hospital', type: 'CAH', lat: 46.9537, lng: -124.1054, city: 'Ilwaco', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 4200, helipad: 'No', ct24: 'Yes' },
            { name: 'Cascade Valley Hospital', type: 'CAH', lat: 48.4474, lng: -121.8858, city: 'Arlington', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 11000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Ferry County Memorial Hospital', type: 'CAH', lat: 48.6093, lng: -118.5514, city: 'Republic', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 1600, helipad: 'No', ct24: 'Yes' },
            { name: 'Grays Harbor Community Hospital', type: 'CAH', lat: 46.9854, lng: -123.8321, city: 'Aberdeen', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'ASR', edVolume: 22000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Island Hospital', type: 'CAH', lat: 48.4625, lng: -122.6092, city: 'Anacortes', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'ASR', edVolume: 14000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Lake Chelan Community Hospital', type: 'CAH', lat: 47.8411, lng: -120.0211, city: 'Chelan', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 6500, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Cascade Medical Center', type: 'CAH', lat: 47.2032, lng: -120.8831, city: 'Leavenworth', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 7200, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Morton General Hospital', type: 'CAH', lat: 46.5581, lng: -122.2897, city: 'Morton', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 2800, helipad: 'No', ct24: 'Yes' },
            { name: 'Packwood Medical Clinic', type: 'CAH', lat: 46.6069, lng: -121.6731, city: 'Packwood', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 900, helipad: 'No', ct24: 'No' },
            { name: 'Prosser Memorial Hospital', type: 'CAH', lat: 46.2068, lng: -119.7689, city: 'Prosser', state: 'WA', partner: 'TBD', affiliation: 'TBD', strokeLevel: 'None', edVolume: 5600, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Skamania County Health Center', type: 'CAH', lat: 45.7190, lng: -121.9517, city: 'Stevenson', state: 'WA', partner: 'OHSU', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 1800, helipad: 'No', ct24: 'Yes' },
            { name: 'Whidbey Health Medical Center', type: 'CAH', lat: 48.2187, lng: -122.6869, city: 'Coupeville', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'ASR', edVolume: 16000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Whitman Hospital', type: 'CAH', lat: 46.9590, lng: -117.3950, city: 'Colfax', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 3200, helipad: 'No', ct24: 'Yes' },
            { name: 'Yakima Valley Farm Workers Clinic - Toppenish', type: 'CAH', lat: 46.3820, lng: -120.3150, city: 'Toppenish', state: 'WA', partner: 'TBD', affiliation: 'TBD', strokeLevel: 'None', edVolume: 4500, helipad: 'No', ct24: 'Yes' },
            { name: 'Columbia County Public Hospital District', type: 'CAH', lat: 46.2340, lng: -118.1640, city: 'Dayton', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 1950, helipad: 'No', ct24: 'Yes' },
            { name: 'Trios Health - Prosser', type: 'CAH', lat: 46.2118, lng: -119.7720, city: 'Prosser', state: 'WA', partner: 'TBD', affiliation: 'TBD', strokeLevel: 'None', edVolume: 5800, helipad: 'Yes', ct24: 'Yes' },

            // === NORTHERN IDAHO CRITICAL ACCESS HOSPITALS (8) ===
            { name: 'Benewah Community Hospital', type: 'CAH', lat: 47.2738, lng: -116.4974, city: 'St. Maries', state: 'ID', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 2400, helipad: 'No', ct24: 'Yes' },
            { name: 'Boundary Community Hospital', type: 'CAH', lat: 48.7569, lng: -116.3386, city: 'Bonners Ferry', state: 'ID', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 3100, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Clearwater Valley Hospital', type: 'CAH', lat: 46.4026, lng: -115.9325, city: 'Orofino', state: 'ID', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 2800, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Gritman Medical Center', type: 'CAH', lat: 46.7298, lng: -117.0014, city: 'Moscow', state: 'ID', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'ASR', edVolume: 11500, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Shoshone Medical Center', type: 'CAH', lat: 47.7465, lng: -116.1481, city: 'Kellogg', state: 'ID', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 4200, helipad: 'Yes', ct24: 'Yes' },
            { name: 'St. Joseph Regional Medical Center', type: 'CAH', lat: 46.4071, lng: -116.9627, city: 'Lewiston', state: 'ID', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'ASR', edVolume: 18500, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Steele Memorial Medical Center', type: 'CAH', lat: 43.6150, lng: -114.3628, city: 'Salmon', state: 'ID', partner: 'TBD', affiliation: 'TBD', strokeLevel: 'None', edVolume: 2900, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Valley Vista Care', type: 'CAH', lat: 46.4817, lng: -116.8233, city: 'Cottonwood', state: 'ID', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 1500, helipad: 'No', ct24: 'Yes' },

            // === SOUTHEAST ALASKA CRITICAL ACCESS HOSPITALS (4) ===
            { name: 'Bartlett Regional Hospital', type: 'CAH', lat: 58.3522, lng: -134.5258, city: 'Juneau', state: 'AK', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'ASR', edVolume: 24000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Mt. Edgecumbe Hospital', type: 'CAH', lat: 57.0528, lng: -135.3308, city: 'Sitka', state: 'AK', partner: 'Indian Health Service', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 8500, helipad: 'Yes', ct24: 'Yes' },
            { name: 'PeaceHealth Ketchikan Medical Center', type: 'CAH', lat: 55.3422, lng: -131.6461, city: 'Ketchikan', state: 'AK', partner: 'PeaceHealth', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 12000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'SEARHC Mt. Edgecumbe Hospital', type: 'CAH', lat: 57.0550, lng: -135.3350, city: 'Sitka', state: 'AK', partner: 'TBD', affiliation: 'TBD', strokeLevel: 'None', edVolume: 6200, helipad: 'Yes', ct24: 'Yes' },

            // === ACUTE CARE HOSPITALS (43) ===
            { name: 'Auburn Regional Medical Center', type: 'Acute', lat: 47.3073, lng: -122.2285, city: 'Auburn', state: 'WA', partner: 'MultiCare', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 42000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Capital Medical Center', type: 'Acute', lat: 47.0379, lng: -122.9007, city: 'Olympia', state: 'WA', partner: 'TBD', affiliation: 'TBD', strokeLevel: 'None', edVolume: 28000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Cascade Behavioral Health', type: 'Acute', lat: 47.5231, lng: -122.2009, city: 'Tukwila', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 5200, helipad: 'No', ct24: 'Yes' },
            { name: 'Central Washington Hospital', type: 'Acute', lat: 47.4232, lng: -120.3103, city: 'Wenatchee', state: 'WA', partner: 'Confluence Health', affiliation: 'Competitor', strokeLevel: 'PSC', edVolume: 38000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Confluence Health - Wenatchee Valley Hospital', type: 'Acute', lat: 47.4298, lng: -120.3156, city: 'Wenatchee', state: 'WA', partner: 'Confluence Health', affiliation: 'Competitor', strokeLevel: 'PSC', edVolume: 35000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'EvergreenHealth Monroe', type: 'Acute', lat: 47.8556, lng: -121.9708, city: 'Monroe', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'ASR', edVolume: 26000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Fairfax Behavioral Health', type: 'Acute', lat: 47.6534, lng: -122.3210, city: 'Kirkland', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 3800, helipad: 'No', ct24: 'No' },
            { name: 'Good Samaritan Hospital', type: 'Acute', lat: 47.6732, lng: -122.2060, city: 'Puyallup', state: 'WA', partner: 'MultiCare', affiliation: 'Competitor', strokeLevel: 'ASR', edVolume: 45000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Highline Medical Center', type: 'Acute', lat: 47.4620, lng: -122.3321, city: 'Burien', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'ASR', edVolume: 32000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Kadlec Regional Medical Center', type: 'Acute', lat: 46.2396, lng: -119.1372, city: 'Richland', state: 'WA', partner: 'Providence', affiliation: 'Competitor', strokeLevel: 'PSC', edVolume: 48000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Kennewick General Hospital', type: 'Acute', lat: 46.2112, lng: -119.1372, city: 'Kennewick', state: 'WA', partner: 'Trios Health', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 31000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Lourdes Medical Center', type: 'Acute', lat: 46.2596, lng: -119.2752, city: 'Pasco', state: 'WA', partner: 'Trios Health', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 29000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'MultiCare Auburn Medical Center', type: 'Acute', lat: 47.3095, lng: -122.2315, city: 'Auburn', state: 'WA', partner: 'MultiCare', affiliation: 'Competitor', strokeLevel: 'ASR', edVolume: 43000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'MultiCare Covington Medical Center', type: 'Acute', lat: 47.3584, lng: -122.1215, city: 'Covington', state: 'WA', partner: 'MultiCare', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 18000, helipad: 'No', ct24: 'Yes' },
            { name: 'Naval Hospital Bremerton', type: 'Acute', lat: 47.5615, lng: -122.6629, city: 'Bremerton', state: 'WA', partner: 'US Navy', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 22000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Naval Hospital Oak Harbor', type: 'Acute', lat: 48.2932, lng: -122.6433, city: 'Oak Harbor', state: 'WA', partner: 'US Navy', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 14000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Overlake Medical Center', type: 'Acute', lat: 47.6229, lng: -122.1765, city: 'Bellevue', state: 'WA', partner: 'TBD', affiliation: 'TBD', strokeLevel: 'PSC', edVolume: 52000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'PeaceHealth Southwest Medical Center', type: 'Acute', lat: 45.6387, lng: -122.5007, city: 'Vancouver', state: 'WA', partner: 'PeaceHealth', affiliation: 'Competitor', strokeLevel: 'CSC', edVolume: 65000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'PeaceHealth St. John Medical Center', type: 'Acute', lat: 46.1312, lng: -122.9540, city: 'Longview', state: 'WA', partner: 'PeaceHealth', affiliation: 'Competitor', strokeLevel: 'ASR', edVolume: 28000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Providence Centralia Hospital', type: 'Acute', lat: 46.7162, lng: -122.9543, city: 'Centralia', state: 'WA', partner: 'Providence', affiliation: 'Competitor', strokeLevel: 'ASR', edVolume: 24000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Providence Holy Family Hospital', type: 'Acute', lat: 47.6951, lng: -117.3890, city: 'Spokane', state: 'WA', partner: 'Providence', affiliation: 'Competitor', strokeLevel: 'ASR', edVolume: 35000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Providence Mount Carmel Hospital', type: 'Acute', lat: 48.4615, lng: -117.9267, city: 'Colville', state: 'WA', partner: 'Providence', affiliation: 'Competitor', strokeLevel: 'ASR', edVolume: 8500, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Providence Regional Medical Center Everett', type: 'Acute', lat: 47.9790, lng: -122.2021, city: 'Everett', state: 'WA', partner: 'Providence', affiliation: 'Competitor', strokeLevel: 'CSC', edVolume: 72000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Providence Sacred Heart Medical Center', type: 'Acute', lat: 47.6587, lng: -117.4260, city: 'Spokane', state: 'WA', partner: 'Providence', affiliation: 'Competitor', strokeLevel: 'CSC', edVolume: 68000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Providence St. Mary Medical Center', type: 'Acute', lat: 47.2529, lng: -122.4443, city: 'Walla Walla', state: 'WA', partner: 'Providence', affiliation: 'Competitor', strokeLevel: 'ASR', edVolume: 22000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Providence St. Peter Hospital', type: 'Acute', lat: 47.0456, lng: -122.9007, city: 'Olympia', state: 'WA', partner: 'Providence', affiliation: 'Competitor', strokeLevel: 'PSC', edVolume: 46000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Seattle Cancer Care Alliance', type: 'Acute', lat: 47.6475, lng: -122.3137, city: 'Seattle', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 2500, helipad: 'No', ct24: 'Yes' },
            { name: "St. Anthony Hospital", type: 'Acute', lat: 47.5481, lng: -122.3321, city: 'Gig Harbor', state: 'WA', partner: 'CHI Franciscan', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 15000, helipad: 'No', ct24: 'Yes' },
            { name: "St. Clare Hospital", type: 'Acute', lat: 47.2412, lng: -122.4386, city: 'Lakewood', state: 'WA', partner: 'CHI Franciscan', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 18000, helipad: 'Yes', ct24: 'Yes' },
            { name: "St. Elizabeth Hospital", type: 'Acute', lat: 47.6765, lng: -122.1215, city: 'Enumclaw', state: 'WA', partner: 'CHI Franciscan', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 12000, helipad: 'Yes', ct24: 'Yes' },
            { name: "St. Francis Hospital", type: 'Acute', lat: 47.2529, lng: -122.4443, city: 'Federal Way', state: 'WA', partner: 'CHI Franciscan', affiliation: 'Competitor', strokeLevel: 'ASR', edVolume: 38000, helipad: 'Yes', ct24: 'Yes' },
            { name: "St. Joseph Medical Center", type: 'Acute', lat: 47.2529, lng: -122.4443, city: 'Tacoma', state: 'WA', partner: 'CHI Franciscan', affiliation: 'Competitor', strokeLevel: 'PSC', edVolume: 44000, helipad: 'Yes', ct24: 'Yes' },
            { name: "St. Michael Medical Center", type: 'Acute', lat: 47.0890, lng: -122.5629, city: 'Silverdale', state: 'WA', partner: 'CHI Franciscan', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 16000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Swedish Ballard', type: 'Acute', lat: 47.6717, lng: -122.3654, city: 'Seattle', state: 'WA', partner: 'Providence', affiliation: 'Competitor', strokeLevel: 'ASR', edVolume: 28000, helipad: 'No', ct24: 'Yes' },
            { name: 'Swedish Cherry Hill', type: 'Acute', lat: 47.6062, lng: -122.3321, city: 'Seattle', state: 'WA', partner: 'Providence', affiliation: 'Competitor', strokeLevel: 'CSC', edVolume: 58000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Swedish Edmonds', type: 'Acute', lat: 47.8107, lng: -122.3774, city: 'Edmonds', state: 'WA', partner: 'Providence', affiliation: 'Competitor', strokeLevel: 'ASR', edVolume: 32000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Swedish First Hill', type: 'Acute', lat: 47.6092, lng: -122.3224, city: 'Seattle', state: 'WA', partner: 'Providence', affiliation: 'Competitor', strokeLevel: 'CSC', edVolume: 62000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Swedish Issaquah', type: 'Acute', lat: 47.5301, lng: -122.0326, city: 'Issaquah', state: 'WA', partner: 'Providence', affiliation: 'Competitor', strokeLevel: 'ASR', edVolume: 24000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Trios Health', type: 'Acute', lat: 46.2112, lng: -119.1372, city: 'Kennewick', state: 'WA', partner: 'Trios Health', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 34000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Valley Medical Center', type: 'Acute', lat: 47.4456, lng: -122.2090, city: 'Renton', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'PSC', edVolume: 48000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Virginia Mason Bainbridge Island', type: 'Acute', lat: 47.6262, lng: -122.5212, city: 'Bainbridge Island', state: 'WA', partner: 'Virginia Mason', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 8500, helipad: 'No', ct24: 'Yes' },
            { name: 'Virginia Mason Federal Way', type: 'Acute', lat: 47.3220, lng: -122.3126, city: 'Federal Way', state: 'WA', partner: 'Virginia Mason', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 14000, helipad: 'No', ct24: 'Yes' },
            { name: 'Yakima Valley Memorial Hospital', type: 'Acute', lat: 46.6021, lng: -120.5059, city: 'Yakima', state: 'WA', partner: 'Virginia Mason', affiliation: 'Competitor', strokeLevel: 'PSC', edVolume: 52000, helipad: 'Yes', ct24: 'Yes' },

            // === PRIMARY STROKE CENTERS (7) ===
            { name: 'MultiCare Good Samaritan Hospital', type: 'PSC', lat: 47.6732, lng: -122.2060, city: 'Puyallup', state: 'WA', partner: 'MultiCare', affiliation: 'Competitor', strokeLevel: 'PSC', edVolume: 46000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'MultiCare Tacoma General Hospital', type: 'PSC', lat: 47.2529, lng: -122.4443, city: 'Tacoma', state: 'WA', partner: 'MultiCare', affiliation: 'Competitor', strokeLevel: 'PSC', edVolume: 54000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'PeaceHealth St. Joseph Medical Center', type: 'PSC', lat: 48.7519, lng: -122.4787, city: 'Bellingham', state: 'WA', partner: 'PeaceHealth', affiliation: 'Competitor', strokeLevel: 'PSC', edVolume: 48000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Providence Regional Medical Center Everett', type: 'PSC', lat: 47.9790, lng: -122.2021, city: 'Everett', state: 'WA', partner: 'Providence', affiliation: 'Competitor', strokeLevel: 'PSC', edVolume: 74000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Skagit Regional Health', type: 'PSC', lat: 48.4121, lng: -122.3374, city: 'Mount Vernon', state: 'WA', partner: 'TBD', affiliation: 'TBD', strokeLevel: 'PSC', edVolume: 42000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Swedish Medical Center - Issaquah', type: 'PSC', lat: 47.5301, lng: -122.0326, city: 'Issaquah', state: 'WA', partner: 'Providence', affiliation: 'Competitor', strokeLevel: 'PSC', edVolume: 26000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Virginia Mason Medical Center', type: 'PSC', lat: 47.6101, lng: -122.3321, city: 'Seattle', state: 'WA', partner: 'Virginia Mason', affiliation: 'Competitor', strokeLevel: 'PSC', edVolume: 48000, helipad: 'Yes', ct24: 'Yes' },

            // === COMPREHENSIVE STROKE CENTERS (17) ===
            { name: 'Harborview Medical Center', type: 'CSC', lat: 47.6052, lng: -122.3204, city: 'Seattle', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'CSC', edVolume: 95000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'UW Medical Center - Montlake', type: 'CSC', lat: 47.6505, lng: -122.3050, city: 'Seattle', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'CSC', edVolume: 52000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'UW Medical Center - Northwest', type: 'CSC', lat: 47.7231, lng: -122.3654, city: 'Seattle', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'CSC', edVolume: 45000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'EvergreenHealth Medical Center', type: 'CSC', lat: 47.6534, lng: -122.2009, city: 'Kirkland', state: 'WA', partner: 'UW Medicine', affiliation: 'UW Medicine', strokeLevel: 'CSC', edVolume: 48000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Providence Sacred Heart Medical Center', type: 'CSC', lat: 47.6587, lng: -117.4260, city: 'Spokane', state: 'WA', partner: 'Providence', affiliation: 'Competitor', strokeLevel: 'CSC', edVolume: 70000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'MultiCare Tacoma General Hospital', type: 'CSC', lat: 47.2529, lng: -122.4443, city: 'Tacoma', state: 'WA', partner: 'MultiCare', affiliation: 'Competitor', strokeLevel: 'CSC', edVolume: 56000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Providence Regional Medical Center Everett', type: 'CSC', lat: 47.9790, lng: -122.2021, city: 'Everett', state: 'WA', partner: 'Providence', affiliation: 'Competitor', strokeLevel: 'CSC', edVolume: 76000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Swedish Medical Center - First Hill', type: 'CSC', lat: 47.6092, lng: -122.3224, city: 'Seattle', state: 'WA', partner: 'Providence', affiliation: 'Competitor', strokeLevel: 'CSC', edVolume: 64000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Swedish Medical Center - Cherry Hill', type: 'CSC', lat: 47.6062, lng: -122.3321, city: 'Seattle', state: 'WA', partner: 'Providence', affiliation: 'Competitor', strokeLevel: 'CSC', edVolume: 60000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'PeaceHealth Southwest Medical Center', type: 'CSC', lat: 45.6387, lng: -122.5007, city: 'Vancouver', state: 'WA', partner: 'PeaceHealth', affiliation: 'Competitor', strokeLevel: 'CSC', edVolume: 67000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Kadlec Regional Medical Center', type: 'CSC', lat: 46.2396, lng: -119.1372, city: 'Richland', state: 'WA', partner: 'Providence', affiliation: 'Competitor', strokeLevel: 'CSC', edVolume: 50000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Virginia Mason Franciscan Health - St. Joseph Medical Center', type: 'CSC', lat: 47.2529, lng: -122.4443, city: 'Tacoma', state: 'WA', partner: 'Virginia Mason', affiliation: 'Competitor', strokeLevel: 'CSC', edVolume: 46000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'CHI Franciscan - St. Joseph Medical Center', type: 'CSC', lat: 47.2529, lng: -122.4443, city: 'Tacoma', state: 'WA', partner: 'CHI Franciscan', affiliation: 'Competitor', strokeLevel: 'CSC', edVolume: 44000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Kootenai Health', type: 'CSC', lat: 47.6788, lng: -116.7805, city: 'Coeur d\'Alene', state: 'ID', partner: 'TBD', affiliation: 'TBD', strokeLevel: 'CSC', edVolume: 54000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Providence St. Mary Medical Center', type: 'CSC', lat: 47.2529, lng: -122.4443, city: 'Walla Walla', state: 'WA', partner: 'Providence', affiliation: 'Competitor', strokeLevel: 'CSC', edVolume: 24000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Alaska Regional Hospital', type: 'CSC', lat: 61.1508, lng: -149.9778, city: 'Anchorage', state: 'AK', partner: 'TBD', affiliation: 'TBD', strokeLevel: 'CSC', edVolume: 48000, helipad: 'Yes', ct24: 'Yes' },
            { name: 'Providence Alaska Medical Center', type: 'CSC', lat: 61.1941, lng: -149.8397, city: 'Anchorage', state: 'AK', partner: 'Providence', affiliation: 'Competitor', strokeLevel: 'CSC', edVolume: 72000, helipad: 'Yes', ct24: 'Yes' }
        ];

        // Initialize the map centered on Pacific Northwest
        const map = L.map('map').setView([47.6, -120.5], 7);

        // Add OpenStreetMap tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            maxZoom: 19
        }).addTo(map);

        // Add Harborview marker (special gold star)
        const harborviewIcon = L.divIcon({
            html: '<div style="background-color: gold; width: 20px; height: 20px; border-radius: 50%; border: 3px solid #333; display: flex; align-items: center; justify-content: center;"><span style="color: #333; font-weight: bold; font-size: 16px;">â˜…</span></div>',
            className: 'custom-div-icon',
            iconSize: [20, 20],
            iconAnchor: [10, 10]
        });

        L.marker([HARBORVIEW.lat, HARBORVIEW.lng], { icon: harborviewIcon })
            .bindPopup(`<strong>${HARBORVIEW.name}</strong><br>Reference Point for Distance Calculations<br>Level I Trauma Center<br>Comprehensive Stroke Center`)
            .addTo(map);

        // Add distance rings from Harborview
        const distanceRings = L.layerGroup();
        const ringDistances = [50, 100, 150, 200]; // miles
        const ringColors = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444'];

        ringDistances.forEach((distance, index) => {
            const radiusInMeters = distance * 1609.34; // Convert miles to meters
            L.circle([HARBORVIEW.lat, HARBORVIEW.lng], {
                color: ringColors[index],
                fillColor: ringColors[index],
                fillOpacity: 0.05,
                radius: radiusInMeters,
                weight: 2
            }).bindPopup(`${distance} mile radius from Harborview`).addTo(distanceRings);
        });
        distanceRings.addTo(map);

        // Function to calculate distance between two points (Haversine formula)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 3959; // Radius of Earth in miles
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                     Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                     Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Function to get marker color based on hospital type
        function getMarkerColor(type) {
            switch(type) {
                case 'CAH': return '#3b82f6'; // Blue
                case 'Acute': return '#6b7280'; // Gray
                case 'PSC': return '#ef4444'; // Red
                case 'CSC': return '#9333ea'; // Purple
                default: return '#6b7280';
            }
        }

        // Function to get label class based on hospital type
        function getLabelClass(type) {
            switch(type) {
                case 'CAH': return 'hospital-label-cah';
                case 'Acute': return 'hospital-label-acute';
                case 'PSC': return 'hospital-label-psc';
                case 'CSC': return 'hospital-label-csc';
                default: return 'hospital-label-acute';
            }
        }

        // Store all markers for filtering
        const markerLayers = {};

        // Add hospital markers
        hospitals.forEach(hospital => {
            const distance = calculateDistance(
                HARBORVIEW.lat, HARBORVIEW.lng,
                hospital.lat, hospital.lng
            );

            hospital.distanceToHMC = Math.round(distance);

            const color = getMarkerColor(hospital.type);
            const labelClass = getLabelClass(hospital.type);

            // Create custom divIcon with label
            const customIcon = L.divIcon({
                html: `
                    <div style="position: relative;">
                        <div style="background-color: ${color}; width: 12px; height: 12px; border-radius: 50%; border: 2px solid #333;"></div>
                        <div class="hospital-label ${labelClass}" style="position: absolute; left: 16px; top: -6px;">${hospital.name}</div>
                    </div>
                `,
                className: 'custom-div-icon',
                iconSize: [12, 12],
                iconAnchor: [6, 6]
            });

            const marker = L.marker([hospital.lat, hospital.lng], { icon: customIcon })
                .bindPopup(`
                    <div style="min-width: 250px;">
                        <h3 style="margin: 0 0 10px 0; font-size: 16px; font-weight: bold;">${hospital.name}</h3>
                        <table style="width: 100%; font-size: 13px;">
                            <tr><td style="padding: 3px 10px 3px 0;"><strong>Type:</strong></td><td style="padding: 3px 0;">${hospital.type}</td></tr>
                            <tr><td style="padding: 3px 10px 3px 0;"><strong>Location:</strong></td><td style="padding: 3px 0;">${hospital.city}, ${hospital.state}</td></tr>
                            <tr><td style="padding: 3px 10px 3px 0;"><strong>Distance to HMC:</strong></td><td style="padding: 3px 0;">${hospital.distanceToHMC} miles</td></tr>
                            <tr><td style="padding: 3px 10px 3px 0;"><strong>Telestroke Partner:</strong></td><td style="padding: 3px 0;">${hospital.partner}</td></tr>
                            <tr><td style="padding: 3px 10px 3px 0;"><strong>Affiliation:</strong></td><td style="padding: 3px 0;">${hospital.affiliation}</td></tr>
                            <tr><td style="padding: 3px 10px 3px 0;"><strong>State Stroke Level:</strong></td><td style="padding: 3px 0;">${hospital.strokeLevel}</td></tr>
                            <tr><td style="padding: 3px 10px 3px 0;"><strong>Annual ED Volume:</strong></td><td style="padding: 3px 0;">${hospital.edVolume.toLocaleString()}</td></tr>
                            <tr><td style="padding: 3px 10px 3px 0;"><strong>Helipad:</strong></td><td style="padding: 3px 0;">${hospital.helipad}</td></tr>
                            <tr><td style="padding: 3px 10px 3px 0;"><strong>24/7 CT:</strong></td><td style="padding: 3px 0;">${hospital.ct24}</td></tr>
                        </table>
                    </div>
                `);

            // Store marker with metadata for filtering
            markerLayers[hospital.name] = {
                marker: marker,
                data: hospital,
                layer: L.layerGroup([marker])
            };

            marker.addTo(map);
        });

        // Update statistics
        function updateStatistics() {
            const visibleHospitals = hospitals.filter(h => {
                const layer = markerLayers[h.name];
                return layer && map.hasLayer(layer.marker);
            });

            const uwCount = visibleHospitals.filter(h => h.affiliation === 'UW Medicine').length;
            const tbdCount = visibleHospitals.filter(h => h.affiliation === 'TBD').length;
            const competitorCount = visibleHospitals.filter(h => h.affiliation === 'Competitor').length;

            const cahCount = visibleHospitals.filter(h => h.type === 'CAH').length;
            const acuteCount = visibleHospitals.filter(h => h.type === 'Acute').length;
            const pscCount = visibleHospitals.filter(h => h.type === 'PSC').length;
            const cscCount = visibleHospitals.filter(h => h.type === 'CSC').length;

            document.getElementById('total-count').textContent = visibleHospitals.length;
            document.getElementById('uw-count').textContent = uwCount;
            document.getElementById('tbd-count').textContent = tbdCount;
            document.getElementById('competitor-count').textContent = competitorCount;
            document.getElementById('cah-count').textContent = cahCount;
            document.getElementById('acute-count').textContent = acuteCount;
            document.getElementById('psc-count').textContent = pscCount;
            document.getElementById('csc-count').textContent = cscCount;
        }

        // Filter function
        function applyFilters() {
            const typeFilters = {
                CAH: document.getElementById('filter-cah').checked,
                Acute: document.getElementById('filter-acute').checked,
                PSC: document.getElementById('filter-psc').checked,
                CSC: document.getElementById('filter-csc').checked
            };

            const affiliationFilters = {
                'UW Medicine': document.getElementById('filter-uw').checked,
                'TBD': document.getElementById('filter-tbd').checked,
                'Competitor': document.getElementById('filter-competitor').checked
            };

            const distanceFilters = {
                '0-50': document.getElementById('filter-0-50').checked,
                '50-100': document.getElementById('filter-50-100').checked,
                '100-150': document.getElementById('filter-100-150').checked,
                '150+': document.getElementById('filter-150-plus').checked
            };

            const showLabels = document.getElementById('toggle-labels').checked;

            hospitals.forEach(hospital => {
                const layer = markerLayers[hospital.name];
                if (!layer) return;

                let show = true;

                // Type filter
                if (!typeFilters[hospital.type]) {
                    show = false;
                }

                // Affiliation filter
                if (!affiliationFilters[hospital.affiliation]) {
                    show = false;
                }

                // Distance filter
                const dist = hospital.distanceToHMC;
                let distanceMatch = false;
                if (dist <= 50 && distanceFilters['0-50']) distanceMatch = true;
                if (dist > 50 && dist <= 100 && distanceFilters['50-100']) distanceMatch = true;
                if (dist > 100 && dist <= 150 && distanceFilters['100-150']) distanceMatch = true;
                if (dist > 150 && distanceFilters['150+']) distanceMatch = true;

                if (!distanceMatch) {
                    show = false;
                }

                // Show/hide marker
                if (show) {
                    if (!map.hasLayer(layer.marker)) {
                        layer.marker.addTo(map);
                    }
                } else {
                    if (map.hasLayer(layer.marker)) {
                        map.removeLayer(layer.marker);
                    }
                }
            });

            // Update label visibility
            const labels = document.querySelectorAll('.hospital-label');
            labels.forEach(label => {
                label.style.display = showLabels ? 'block' : 'none';
            });

            updateStatistics();
        }

        // Reset filters function
        function resetFilters() {
            document.getElementById('filter-cah').checked = true;
            document.getElementById('filter-acute').checked = true;
            document.getElementById('filter-psc').checked = true;
            document.getElementById('filter-csc').checked = true;
            document.getElementById('filter-uw').checked = true;
            document.getElementById('filter-tbd').checked = true;
            document.getElementById('filter-competitor').checked = true;
            document.getElementById('filter-0-50').checked = true;
            document.getElementById('filter-50-100').checked = true;
            document.getElementById('filter-100-150').checked = true;
            document.getElementById('filter-150-plus').checked = true;
            document.getElementById('toggle-labels').checked = true;
            document.getElementById('toggle-rings').checked = true;

            if (map.hasLayer(distanceRings)) {
                // already on map
            } else {
                distanceRings.addTo(map);
            }

            applyFilters();
        }

        // Add event listeners to all filters
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                if (checkbox.id === 'toggle-rings') {
                    if (checkbox.checked) {
                        distanceRings.addTo(map);
                    } else {
                        map.removeLayer(distanceRings);
                    }
                } else {
                    applyFilters();
                }
            });
        });

        // Initial statistics update
        updateStatistics();

        // Log hospital count for verification
        console.log('Total hospitals loaded:', hospitals.length);
        console.log('CAH:', hospitals.filter(h => h.type === 'CAH').length);
        console.log('Acute:', hospitals.filter(h => h.type === 'Acute').length);
        console.log('PSC:', hospitals.filter(h => h.type === 'PSC').length);
        console.log('CSC:', hospitals.filter(h => h.type === 'CSC').length);
    </script>
</body>
</html>
