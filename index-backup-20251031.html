<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telestroke Expansion Strategy Planning Map</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }

        #map {
            height: 100vh;
            width: 100%;
        }

        .control-panel {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            max-width: 350px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .legend {
            position: absolute;
            bottom: 30px;
            left: 10px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            border: 2px solid #333;
        }

        .stats-panel {
            position: absolute;
            top: 10px;
            left: 10px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            min-width: 250px;
        }

        .filter-section {
            margin: 15px 0;
            padding: 10px 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .filter-section:last-child {
            border-bottom: none;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            margin: 8px 0;
            cursor: pointer;
        }

        .checkbox-label input {
            margin-right: 8px;
        }

        /* Custom hospital label styles */
        .hospital-label {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid #333;
            border-radius: 3px;
            padding: 2px 6px;
            font-size: 10px;
            font-weight: 600;
            white-space: nowrap;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
            pointer-events: none;
            transition: opacity 0.2s;
        }

        .hospital-label-cah { border-color: #3b82f6; color: #3b82f6; }
        .hospital-label-acute { border-color: #6b7280; color: #6b7280; }
        .hospital-label-psc { border-color: #ef4444; color: #ef4444; }
        .hospital-label-csc { border-color: #9333ea; color: #9333ea; }

        /* Zoom-based label visibility */
        .label-priority-high { display: block; }
        .label-priority-medium { display: none; }
        .label-priority-low { display: none; }

        /* Show labels on hover */
        .custom-div-icon:hover .hospital-label {
            display: block !important;
            opacity: 1 !important;
            z-index: 1000;
        }

        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .stats-panel {
                top: 10px;
                left: 10px;
                right: auto;
                max-width: calc(100vw - 20px);
                font-size: 12px;
            }

            .control-panel {
                top: auto;
                bottom: 10px;
                right: 10px;
                left: 10px;
                max-height: 50vh;
                max-width: none;
            }

            .legend {
                bottom: 70px;
                left: 10px;
                font-size: 11px;
            }

            /* Larger touch targets for mobile */
            .checkbox-label {
                min-height: 44px;
                align-items: center;
            }

            button {
                min-height: 44px;
            }

            /* Hide legend on very small screens */
            @media (max-height: 600px) {
                .legend {
                    display: none;
                }
            }
        }

        /* Tablet adjustments */
        @media (min-width: 769px) and (max-width: 1024px) {
            .control-panel {
                max-width: 300px;
            }

            .stats-panel {
                min-width: 220px;
            }
        }

        /* Print styles */
        @media print {
            .control-panel, .no-print { display: none; }
            #map { height: 100vh; }
            .stats-panel {
                position: relative !important;
                max-width: 100% !important;
            }
        }

        /* Better touch targets */
        button, .checkbox-label, select {
            min-height: 36px;
        }

        input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #1f2937;
        }

        .stat-label {
            font-size: 12px;
            color: #6b7280;
            text-transform: uppercase;
        }

        button {
            transition: all 0.2s;
        }

        button:hover {
            transform: translateY(-1px);
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <!-- Statistics Panel -->
    <div class="stats-panel">
        <h3 class="text-lg font-bold mb-3">Network Statistics</h3>
        <div class="space-y-3">
            <div>
                <div class="stat-value" id="total-count">124</div>
                <div class="stat-label">Total Facilities Shown</div>
            </div>

            <!-- UW Partners Highlight -->
            <div class="bg-amber-50 border-2 border-amber-600 rounded-lg p-3">
                <div class="font-bold text-amber-600 text-2xl" id="uw-partner-count">16</div>
                <div class="text-xs font-semibold text-amber-900">UW Telestroke Partners</div>
                <div class="text-xs text-amber-700 mt-1" id="uw-coverage-pct">12.9% of facilities</div>
            </div>

            <!-- Hospital Types -->
            <div class="grid grid-cols-2 gap-2 text-sm">
                <div>
                    <div class="font-bold text-blue-600" id="cah-count">56</div>
                    <div class="text-xs text-gray-600">Critical Access</div>
                </div>
                <div>
                    <div class="font-bold text-gray-600" id="acute-count">44</div>
                    <div class="text-xs text-gray-600">Acute Care</div>
                </div>
                <div>
                    <div class="font-bold text-red-600" id="psc-count">8</div>
                    <div class="text-xs text-gray-600">Primary Stroke</div>
                </div>
                <div>
                    <div class="font-bold text-purple-600" id="csc-count">16</div>
                    <div class="text-xs text-gray-600">Comprehensive</div>
                </div>
            </div>

            <!-- Coverage Analysis -->
            <div class="mt-3 pt-3 border-t border-gray-300">
                <div class="text-xs font-semibold text-gray-700 mb-2">Coverage by Distance</div>
                <div class="text-xs space-y-1">
                    <div class="flex justify-between">
                        <span>0-50 miles:</span>
                        <span class="font-semibold" id="coverage-0-50">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span>50-100 miles:</span>
                        <span class="font-semibold" id="coverage-50-100">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span>100-150 miles:</span>
                        <span class="font-semibold" id="coverage-100-150">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span>150+ miles:</span>
                        <span class="font-semibold" id="coverage-150-plus">-</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Control Panel -->
    <div class="control-panel">
        <h3 class="text-lg font-bold mb-4">Map Controls</h3>

        <!-- Search Functionality -->
        <div class="filter-section">
            <h4 class="font-semibold mb-2 text-sm">Search Hospitals</h4>
            <input type="text" id="hospital-search" placeholder="Type hospital name..."
                   class="w-full p-2 border border-gray-300 rounded text-sm mb-2">
            <div id="search-results" class="text-xs max-h-40 overflow-y-auto hidden"></div>
        </div>

        <!-- Quick Actions -->
        <div class="filter-section">
            <h4 class="font-semibold mb-2 text-sm">Quick Views</h4>
            <div class="grid grid-cols-2 gap-2">
                <button onclick="showUWPartnersOnly()" class="text-xs bg-amber-600 text-white py-2 px-3 rounded hover:bg-amber-700">
                    UW Partners
                </button>
                <button onclick="showNonPartnersOnly()" class="text-xs bg-gray-600 text-white py-2 px-3 rounded hover:bg-gray-700">
                    Non-Partners
                </button>
                <button onclick="showCSCPSCOnly()" class="text-xs bg-purple-600 text-white py-2 px-3 rounded hover:bg-purple-700">
                    Stroke Centers
                </button>
                <button onclick="showCAHOnly()" class="text-xs bg-blue-600 text-white py-2 px-3 rounded hover:bg-blue-700">
                    CAH Only
                </button>
            </div>
        </div>

        <!-- UW Medicine Partner Filter -->
        <div class="filter-section">
            <h4 class="font-semibold mb-2 text-sm">UW Medicine Network</h4>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-uw-partners" checked>
                <span class="text-amber-600 font-semibold">Show UW Telestroke Partners (16)</span>
            </label>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-non-partners" checked>
                <span>Show Non-Partner Hospitals</span>
            </label>
        </div>

        <!-- Hospital Type Filters -->
        <div class="filter-section">
            <h4 class="font-semibold mb-2 text-sm">Hospital Types</h4>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-cah" checked>
                <span>Critical Access Hospitals (56)</span>
            </label>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-acute" checked>
                <span>Acute Care Hospitals (44)</span>
            </label>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-psc" checked>
                <span>Primary Stroke Centers (8)</span>
            </label>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-csc" checked>
                <span>Comprehensive Stroke Centers (16)</span>
            </label>
        </div>


        <!-- Distance Filters -->
        <div class="filter-section">
            <h4 class="font-semibold mb-2 text-sm">Distance from Harborview</h4>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-0-50" checked>
                <span>0-50 miles</span>
            </label>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-50-100" checked>
                <span>50-100 miles</span>
            </label>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-100-150" checked>
                <span>100-150 miles</span>
            </label>
            <label class="checkbox-label">
                <input type="checkbox" id="filter-150-plus" checked>
                <span>150+ miles</span>
            </label>
        </div>

        <!-- Display Options -->
        <div class="filter-section">
            <h4 class="font-semibold mb-2 text-sm">Display Options</h4>
            <div class="mb-3">
                <label class="text-xs font-semibold text-gray-700 mb-1 block">Label Display Mode</label>
                <select id="label-mode" class="w-full p-2 border border-gray-300 rounded text-sm">
                    <option value="hover">Show on Hover Only</option>
                    <option value="zoom">Zoom-Based (Smart)</option>
                    <option value="always">Always Show All</option>
                    <option value="partners">UW Partners Only</option>
                    <option value="none">Hide All Labels</option>
                </select>
            </div>
            <label class="checkbox-label">
                <input type="checkbox" id="toggle-rings" checked>
                <span>Show Distance Rings</span>
            </label>
        </div>

        <!-- Action Buttons -->
        <div class="mt-4 space-y-2">
            <button onclick="exportToCSV()" class="w-full bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700">
                üìä Export to CSV
            </button>
            <button onclick="resetFilters()" class="w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700">
                üîÑ Reset All Filters
            </button>
            <button onclick="window.print()" class="w-full bg-gray-600 text-white py-2 px-4 rounded hover:bg-gray-700">
                üñ®Ô∏è Print Map
            </button>
        </div>

    </div>

    <!-- Legend -->
    <div class="legend">
        <h4 class="font-semibold mb-2 text-sm">Legend</h4>
        <div class="text-xs text-gray-600 mb-2" style="font-style: italic;">Colors show National Certification</div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #3b82f6;"></div>
            <span class="text-sm">Critical Access Hospital</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #6b7280;"></div>
            <span class="text-sm">Acute Care Hospital</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #ef4444;"></div>
            <span class="text-sm">Primary Stroke Center</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #9333ea;"></div>
            <span class="text-sm">Comprehensive Stroke Center</span>
        </div>
        <div class="mt-3 pt-3 border-t border-gray-300">
            <div class="legend-item">
                <div style="width: 20px; height: 20px; border-radius: 50%; border: 3px solid #f59e0b; background: white; margin-right: 10px;"></div>
                <span class="text-sm font-semibold text-amber-600">UW Medicine Partner</span>
            </div>
        </div>
        <div class="mt-2">
            <div class="legend-item">
                <div style="padding: 2px 6px; background: #10b981; color: white; font-size: 9px; font-weight: bold; border-radius: 3px; margin-right: 10px;">ELVO</div>
                <span class="text-xs">24/7 Thrombectomy</span>
            </div>
        </div>
        <div class="mt-3 pt-3 border-t border-gray-300">
            <div class="text-xs text-gray-600">
                <strong>Dual Designation System:</strong><br>
                ‚Ä¢ National: DNV/Joint Commission certification<br>
                ‚Ä¢ WA State: Level I, II, III designation<br>
                <span style="font-style: italic; font-size: 10px;">Click hospital for both designations</span>
            </div>
        </div>
        <div class="mt-3 pt-3 border-t border-gray-300">
            <div class="text-xs text-gray-600">
                <strong>Harborview Medical Center</strong><br>
                Base location for distance rings
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // Harborview Medical Center coordinates
        const HARBORVIEW = {
            lat: 47.6052,
            lng: -122.3204,
            name: 'Harborview Medical Center'
        };

        // Complete hospital data - ALL hospitals including UW Medicine Telestroke Partners
        const hospitals = [
            // === WASHINGTON CRITICAL ACCESS HOSPITALS (43) ===
            { name: 'Columbia County Health System', type: 'CAH', lat: 46.2982, lng: -118.1583, city: 'Dayton', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 1800, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Coulee Medical Center', type: 'CAH', lat: 47.2757, lng: -119.2894, city: 'Grand Coulee', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 3200, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Dayton General Hospital', type: 'CAH', lat: 46.3238, lng: -117.9722, city: 'Dayton', state: 'WA', affiliation: 'TBD', strokeLevel: 'None', edVolume: 1500, helipad: 'No', ct24: 'Yes', uwPartner: false },
            { name: 'East Adams Rural Hospital', type: 'CAH', lat: 47.1365, lng: -118.1947, city: 'Ritzville', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 2100, helipad: 'No', ct24: 'Yes', uwPartner: false },
            { name: 'Forks Community Hospital', type: 'CAH', lat: 47.9501, lng: -124.3856, city: 'Forks', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 2800, helipad: 'No', ct24: 'Yes', uwPartner: false },
            { name: 'Garfield County Public Hospital', type: 'CAH', lat: 46.4207, lng: -117.6272, city: 'Pomeroy', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 1200, helipad: 'No', ct24: 'Yes', uwPartner: false },
            { name: 'Jefferson Healthcare', type: 'CAH', lat: 48.1121, lng: -122.7601, city: 'Port Townsend', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 8500, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Klickitat Valley Health', type: 'CAH', lat: 45.8151, lng: -121.5211, city: 'Goldendale', state: 'WA', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 3400, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Lincoln Hospital', type: 'CAH', lat: 47.6579, lng: -118.3836, city: 'Davenport', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 1800, helipad: 'No', ct24: 'Yes', uwPartner: false },
            { name: 'Mid-Valley Hospital', type: 'CAH', lat: 46.4101, lng: -120.5059, city: 'Omak', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 5200, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Mt. Carmel Hospital', type: 'CAH', lat: 46.0907, lng: -118.3430, city: 'Colville', state: 'WA', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 2400, helipad: 'No', ct24: 'Yes', uwPartner: false },
            { name: 'Newport Hospital & Health Services', type: 'CAH', lat: 48.1785, lng: -117.0442, city: 'Newport', state: 'WA', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 4100, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'North Valley Hospital', type: 'CAH', lat: 48.9217, lng: -119.5103, city: 'Tonasket', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 3600, helipad: 'No', ct24: 'Yes', uwPartner: false },
            { name: 'Odessa Memorial Healthcare Center', type: 'CAH', lat: 47.3326, lng: -118.6947, city: 'Odessa', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 1100, helipad: 'No', ct24: 'Yes', uwPartner: false },
            { name: 'Pullman Regional Hospital', type: 'CAH', lat: 46.7312, lng: -117.1796, city: 'Pullman', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'ASR', edVolume: 12000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Quincy Valley Medical Center', type: 'CAH', lat: 47.2338, lng: -119.8528, city: 'Quincy', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 6800, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Samaritan Healthcare', type: 'CAH', lat: 47.9562, lng: -119.4211, city: 'Moses Lake', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'ASR', edVolume: 18000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Sunnyside Community Hospital', type: 'CAH', lat: 46.3237, lng: -120.0087, city: 'Sunnyside', state: 'WA', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 9200, helipad: 'Yes', ct24: 'Yes', uwPartner: true },
            { name: 'Three Rivers Hospital', type: 'CAH', lat: 48.3640, lng: -119.6550, city: 'Brewster', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 3900, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Summit Pacific Medical Center', type: 'CAH', lat: 46.9540, lng: -123.8356, city: 'Elma', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 7500, helipad: 'No', ct24: 'Yes', uwPartner: false },
            { name: 'Toppenish Community Hospital', type: 'CAH', lat: 46.3779, lng: -120.3081, city: 'Toppenish', state: 'WA', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 8900, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Willapa Harbor Hospital', type: 'CAH', lat: 46.6751, lng: -123.9351, city: 'South Bend', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 2200, helipad: 'No', ct24: 'Yes', uwPartner: false },
            { name: 'Othello Community Hospital', type: 'CAH', lat: 46.8260, lng: -119.1753, city: 'Othello', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 5100, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Ocean Beach Hospital', type: 'CAH', lat: 46.9537, lng: -124.1054, city: 'Ilwaco', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 4200, helipad: 'No', ct24: 'Yes', uwPartner: false },
            { name: 'Cascade Valley Hospital', type: 'CAH', lat: 48.4474, lng: -121.8858, city: 'Arlington', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 11000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Ferry County Memorial Hospital', type: 'CAH', lat: 48.6093, lng: -118.5514, city: 'Republic', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 1600, helipad: 'No', ct24: 'Yes', uwPartner: false },
            { name: 'Grays Harbor Community Hospital', type: 'CAH', lat: 46.9854, lng: -123.8321, city: 'Aberdeen', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'ASR', edVolume: 22000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Island Hospital', type: 'CAH', lat: 48.4625, lng: -122.6092, city: 'Anacortes', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'ASR', edVolume: 14000, helipad: 'Yes', ct24: 'Yes', uwPartner: true },
            { name: 'Lake Chelan Community Hospital', type: 'CAH', lat: 47.8411, lng: -120.0211, city: 'Chelan', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 6500, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Cascade Medical Center', type: 'CAH', lat: 47.2032, lng: -120.8831, city: 'Leavenworth', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 7200, helipad: 'Yes', ct24: 'Yes', uwPartner: true },
            { name: 'Morton General Hospital', type: 'CAH', lat: 46.5581, lng: -122.2897, city: 'Morton', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 2800, helipad: 'No', ct24: 'Yes', uwPartner: false },
            { name: 'Packwood Medical Clinic', type: 'CAH', lat: 46.6069, lng: -121.6731, city: 'Packwood', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 900, helipad: 'No', ct24: 'No', uwPartner: false },
            { name: 'Prosser Memorial Hospital', type: 'CAH', lat: 46.2068, lng: -119.7689, city: 'Prosser', state: 'WA', affiliation: 'TBD', strokeLevel: 'None', edVolume: 5600, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Skamania County Health Center', type: 'CAH', lat: 45.7190, lng: -121.9517, city: 'Stevenson', state: 'WA', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 1800, helipad: 'No', ct24: 'Yes', uwPartner: false },
            { name: 'Whidbey Health Medical Center', type: 'CAH', lat: 48.2187, lng: -122.6869, city: 'Coupeville', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'ASR', edVolume: 16000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Whitman Hospital', type: 'CAH', lat: 46.9590, lng: -117.3950, city: 'Colfax', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 3200, helipad: 'No', ct24: 'Yes', uwPartner: false },
            { name: 'Yakima Valley Farm Workers Clinic - Toppenish', type: 'CAH', lat: 46.3820, lng: -120.3150, city: 'Toppenish', state: 'WA', affiliation: 'TBD', strokeLevel: 'None', edVolume: 4500, helipad: 'No', ct24: 'Yes', uwPartner: false },
            { name: 'Columbia County Public Hospital District', type: 'CAH', lat: 46.2340, lng: -118.1640, city: 'Dayton', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 1950, helipad: 'No', ct24: 'Yes', uwPartner: false },
            { name: 'Trios Health - Prosser', type: 'CAH', lat: 46.2118, lng: -119.7720, city: 'Prosser', state: 'WA', affiliation: 'TBD', strokeLevel: 'None', edVolume: 5800, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Columbia Basin Hospital', type: 'CAH', lat: 47.3183, lng: -119.5547, city: 'Ephrata', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 5000, helipad: 'Yes', ct24: 'Yes', uwPartner: true },
            { name: 'Mason General Hospital', type: 'CAH', lat: 47.2151, lng: -123.0987, city: 'Shelton', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 8000, helipad: 'Yes', ct24: 'Yes', uwPartner: true },
            { name: 'Snoqualmie Valley Hospital', type: 'CAH', lat: 47.5287, lng: -121.8254, city: 'Snoqualmie', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 6000, helipad: 'No', ct24: 'Yes', uwPartner: true },
            { name: 'PeaceHealth Island Hospital', type: 'CAH', lat: 48.5343, lng: -123.0174, city: 'Friday Harbor', state: 'WA', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 4500, helipad: 'No', ct24: 'Yes', uwPartner: true },

            // === NORTHERN IDAHO CRITICAL ACCESS HOSPITALS (8) ===
            { name: 'Benewah Community Hospital', type: 'CAH', lat: 47.2738, lng: -116.4974, city: 'St. Maries', state: 'ID', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 2400, helipad: 'No', ct24: 'Yes', uwPartner: false },
            { name: 'Boundary Community Hospital', type: 'CAH', lat: 48.7569, lng: -116.3386, city: 'Bonners Ferry', state: 'ID', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 3100, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Clearwater Valley Hospital', type: 'CAH', lat: 46.4026, lng: -115.9325, city: 'Orofino', state: 'ID', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 2800, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Gritman Medical Center', type: 'CAH', lat: 46.7298, lng: -117.0014, city: 'Moscow', state: 'ID', affiliation: 'UW Medicine', strokeLevel: 'ASR', edVolume: 11500, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Shoshone Medical Center', type: 'CAH', lat: 47.7465, lng: -116.1481, city: 'Kellogg', state: 'ID', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 4200, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'St. Joseph Regional Medical Center', type: 'CAH', lat: 46.4071, lng: -116.9627, city: 'Lewiston', state: 'ID', affiliation: 'UW Medicine', strokeLevel: 'ASR', edVolume: 18500, helipad: 'Yes', ct24: 'Yes', uwPartner: true },
            { name: 'Steele Memorial Medical Center', type: 'CAH', lat: 43.6150, lng: -114.3628, city: 'Salmon', state: 'ID', affiliation: 'TBD', strokeLevel: 'None', edVolume: 2900, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Valley Vista Care', type: 'CAH', lat: 46.4817, lng: -116.8233, city: 'Cottonwood', state: 'ID', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 1500, helipad: 'No', ct24: 'Yes', uwPartner: false },

            // === SOUTHEAST ALASKA CRITICAL ACCESS HOSPITALS (5) ===
            { name: 'Bartlett Regional Hospital', type: 'CAH', lat: 58.3522, lng: -134.5258, city: 'Juneau', state: 'AK', affiliation: 'UW Medicine', strokeLevel: 'ASR', edVolume: 24000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Mt. Edgecumbe Hospital', type: 'CAH', lat: 57.0528, lng: -135.3308, city: 'Sitka', state: 'AK', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 8500, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'PeaceHealth Ketchikan Medical Center', type: 'CAH', lat: 55.3422, lng: -131.6461, city: 'Ketchikan', state: 'AK', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 12000, helipad: 'Yes', ct24: 'Yes', uwPartner: true },
            { name: 'SEARHC Mt. Edgecumbe Hospital', type: 'CAH', lat: 57.0550, lng: -135.3350, city: 'Sitka', state: 'AK', affiliation: 'TBD', strokeLevel: 'None', edVolume: 6200, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Petersburg Medical Center', type: 'CAH', lat: 56.8125, lng: -132.9561, city: 'Petersburg', state: 'AK', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 3500, helipad: 'Yes', ct24: 'Yes', uwPartner: true },

            // === ACUTE CARE HOSPITALS (44) ===
            { name: 'Auburn Regional Medical Center', type: 'Acute', lat: 47.3073, lng: -122.2285, city: 'Auburn', state: 'WA', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 42000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Capital Medical Center', type: 'Acute', lat: 47.0379, lng: -122.9007, city: 'Olympia', state: 'WA', affiliation: 'TBD', strokeLevel: 'None', edVolume: 28000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Cascade Behavioral Health', type: 'Acute', lat: 47.5231, lng: -122.2009, city: 'Tukwila', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 5200, helipad: 'No', ct24: 'Yes', uwPartner: false },
            { name: 'Central Washington Hospital', type: 'Acute', lat: 47.4232, lng: -120.3103, city: 'Wenatchee', state: 'WA', affiliation: 'Competitor', strokeLevel: 'PSC', edVolume: 38000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Confluence Health - Wenatchee Valley Hospital', type: 'Acute', lat: 47.4298, lng: -120.3156, city: 'Wenatchee', state: 'WA', affiliation: 'Competitor', strokeLevel: 'PSC', edVolume: 35000, helipad: 'Yes', ct24: 'Yes', uwPartner: true },
            { name: 'EvergreenHealth Monroe', type: 'Acute', lat: 47.8556, lng: -121.9708, city: 'Monroe', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'ASR', edVolume: 26000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Fairfax Behavioral Health', type: 'Acute', lat: 47.6534, lng: -122.3210, city: 'Kirkland', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 3800, helipad: 'No', ct24: 'No', uwPartner: false },
            { name: 'Good Samaritan Hospital', type: 'Acute', lat: 47.6732, lng: -122.2060, city: 'Puyallup', state: 'WA', affiliation: 'Competitor', strokeLevel: 'ASR', edVolume: 45000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Highline Medical Center', type: 'Acute', lat: 47.4620, lng: -122.3321, city: 'Burien', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'ASR', edVolume: 32000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Kadlec Regional Medical Center', type: 'Acute', lat: 46.2396, lng: -119.1372, city: 'Richland', state: 'WA', affiliation: 'Competitor', strokeLevel: 'PSC', edVolume: 48000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Kennewick General Hospital', type: 'Acute', lat: 46.2112, lng: -119.1372, city: 'Kennewick', state: 'WA', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 31000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Lourdes Medical Center', type: 'Acute', lat: 46.2596, lng: -119.2752, city: 'Pasco', state: 'WA', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 29000, helipad: 'Yes', ct24: 'Yes', uwPartner: true },
            { name: 'MultiCare Auburn Medical Center', type: 'Acute', lat: 47.3095, lng: -122.2315, city: 'Auburn', state: 'WA', affiliation: 'Competitor', strokeLevel: 'ASR', edVolume: 43000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'MultiCare Covington Medical Center', type: 'Acute', lat: 47.3584, lng: -122.1215, city: 'Covington', state: 'WA', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 18000, helipad: 'No', ct24: 'Yes', uwPartner: false },
            { name: 'Naval Hospital Bremerton', type: 'Acute', lat: 47.5615, lng: -122.6629, city: 'Bremerton', state: 'WA', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 22000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Naval Hospital Oak Harbor', type: 'Acute', lat: 48.2932, lng: -122.6433, city: 'Oak Harbor', state: 'WA', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 14000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Overlake Medical Center', type: 'Acute', lat: 47.6229, lng: -122.1765, city: 'Bellevue', state: 'WA', affiliation: 'TBD', strokeLevel: 'PSC', edVolume: 52000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'PeaceHealth Southwest Medical Center', type: 'Acute', lat: 45.6387, lng: -122.5007, city: 'Vancouver', state: 'WA', affiliation: 'Competitor', strokeLevel: 'CSC', edVolume: 65000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'PeaceHealth St. John Medical Center', type: 'Acute', lat: 46.1312, lng: -122.9540, city: 'Longview', state: 'WA', affiliation: 'Competitor', strokeLevel: 'ASR', edVolume: 28000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Providence Centralia Hospital', type: 'Acute', lat: 46.7162, lng: -122.9543, city: 'Centralia', state: 'WA', affiliation: 'Competitor', strokeLevel: 'ASR', edVolume: 24000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Providence Holy Family Hospital', type: 'Acute', lat: 47.6951, lng: -117.3890, city: 'Spokane', state: 'WA', affiliation: 'Competitor', strokeLevel: 'ASR', edVolume: 35000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Providence Mount Carmel Hospital', type: 'Acute', lat: 48.4615, lng: -117.9267, city: 'Colville', state: 'WA', affiliation: 'Competitor', strokeLevel: 'ASR', edVolume: 8500, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Providence Regional Medical Center Everett', type: 'Acute', lat: 47.9790, lng: -122.2021, city: 'Everett', state: 'WA', affiliation: 'Competitor', strokeLevel: 'CSC', edVolume: 72000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Providence Sacred Heart Medical Center', type: 'Acute', lat: 47.6587, lng: -117.4260, city: 'Spokane', state: 'WA', affiliation: 'Competitor', strokeLevel: 'CSC', edVolume: 68000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Providence St. Mary Medical Center', type: 'Acute', lat: 47.2529, lng: -122.4443, city: 'Walla Walla', state: 'WA', affiliation: 'Competitor', strokeLevel: 'ASR', edVolume: 22000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Providence St. Peter Hospital', type: 'Acute', lat: 47.0456, lng: -122.9007, city: 'Olympia', state: 'WA', affiliation: 'Competitor', strokeLevel: 'PSC', edVolume: 46000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Seattle Cancer Care Alliance', type: 'Acute', lat: 47.6475, lng: -122.3137, city: 'Seattle', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'None', edVolume: 2500, helipad: 'No', ct24: 'Yes', uwPartner: false },
            { name: "St. Anthony Hospital", type: 'Acute', lat: 47.5481, lng: -122.3321, city: 'Gig Harbor', state: 'WA', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 15000, helipad: 'No', ct24: 'Yes', uwPartner: false },
            { name: "St. Clare Hospital", type: 'Acute', lat: 47.2412, lng: -122.4386, city: 'Lakewood', state: 'WA', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 18000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: "St. Elizabeth Hospital", type: 'Acute', lat: 47.6765, lng: -122.1215, city: 'Enumclaw', state: 'WA', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 12000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: "St. Francis Hospital", type: 'Acute', lat: 47.2529, lng: -122.4443, city: 'Federal Way', state: 'WA', affiliation: 'Competitor', strokeLevel: 'ASR', edVolume: 38000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: "St. Joseph Medical Center", type: 'Acute', lat: 47.2529, lng: -122.4443, city: 'Tacoma', state: 'WA', affiliation: 'Competitor', strokeLevel: 'PSC', edVolume: 44000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: "St. Michael Medical Center", type: 'Acute', lat: 47.0890, lng: -122.5629, city: 'Silverdale', state: 'WA', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 16000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Swedish Ballard', type: 'Acute', lat: 47.6717, lng: -122.3654, city: 'Seattle', state: 'WA', affiliation: 'Competitor', strokeLevel: 'ASR', edVolume: 28000, helipad: 'No', ct24: 'Yes', uwPartner: false },
            { name: 'Swedish Cherry Hill', type: 'Acute', lat: 47.6062, lng: -122.3321, city: 'Seattle', state: 'WA', affiliation: 'Competitor', strokeLevel: 'CSC', edVolume: 58000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Swedish Edmonds', type: 'Acute', lat: 47.8107, lng: -122.3774, city: 'Edmonds', state: 'WA', affiliation: 'Competitor', strokeLevel: 'ASR', edVolume: 32000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Swedish First Hill', type: 'Acute', lat: 47.6092, lng: -122.3224, city: 'Seattle', state: 'WA', affiliation: 'Competitor', strokeLevel: 'CSC', edVolume: 62000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Swedish Issaquah', type: 'Acute', lat: 47.5301, lng: -122.0326, city: 'Issaquah', state: 'WA', affiliation: 'Competitor', strokeLevel: 'ASR', edVolume: 24000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Trios Health', type: 'Acute', lat: 46.2112, lng: -119.1372, city: 'Kennewick', state: 'WA', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 34000, helipad: 'Yes', ct24: 'Yes', uwPartner: true },
            { name: 'Valley Medical Center', type: 'Acute', lat: 47.4456, lng: -122.2090, city: 'Renton', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'PSC', edVolume: 48000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Virginia Mason Bainbridge Island', type: 'Acute', lat: 47.6262, lng: -122.5212, city: 'Bainbridge Island', state: 'WA', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 8500, helipad: 'No', ct24: 'Yes', uwPartner: false },
            { name: 'Virginia Mason Federal Way', type: 'Acute', lat: 47.3220, lng: -122.3126, city: 'Federal Way', state: 'WA', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 14000, helipad: 'No', ct24: 'Yes', uwPartner: false },
            { name: 'Yakima Valley Memorial Hospital', type: 'Acute', lat: 46.6021, lng: -120.5059, city: 'Yakima', state: 'WA', affiliation: 'Competitor', strokeLevel: 'PSC', edVolume: 52000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'PeaceHealth United General Medical Center', type: 'Acute', lat: 48.5032, lng: -122.2362, city: 'Sedro Woolley', state: 'WA', affiliation: 'Competitor', strokeLevel: 'None', edVolume: 15000, helipad: 'Yes', ct24: 'Yes', uwPartner: true },

            // === PRIMARY STROKE CENTERS (8) ===
            { name: 'MultiCare Good Samaritan Hospital', type: 'PSC', lat: 47.6732, lng: -122.2060, city: 'Puyallup', state: 'WA', affiliation: 'Competitor', strokeLevel: 'PSC', nationalCert: 'PSC', waStateStroke: 'II', waStateCardiac: 'I', hasELVO: false, edVolume: 46000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'PeaceHealth St. Joseph Medical Center', type: 'PSC', lat: 48.7519, lng: -122.4787, city: 'Bellingham', state: 'WA', affiliation: 'Competitor', strokeLevel: 'PSC', nationalCert: 'PSC', waStateStroke: 'II', waStateCardiac: 'I', hasELVO: false, edVolume: 48000, helipad: 'Yes', ct24: 'Yes', uwPartner: true },
            { name: 'Skagit Regional Health', type: 'PSC', lat: 48.4121, lng: -122.3374, city: 'Mount Vernon', state: 'WA', affiliation: 'TBD', strokeLevel: 'PSC', nationalCert: 'PSC', waStateStroke: 'II', waStateCardiac: 'I', hasELVO: false, edVolume: 42000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Swedish Medical Center - Issaquah', type: 'PSC', lat: 47.5301, lng: -122.0326, city: 'Issaquah', state: 'WA', affiliation: 'Competitor', strokeLevel: 'PSC', nationalCert: 'PSC', waStateStroke: 'II', waStateCardiac: 'I', hasELVO: false, edVolume: 26000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'UW Medical Center - Northwest', type: 'PSC', lat: 47.7231, lng: -122.3654, city: 'Seattle', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'PSC', nationalCert: 'Joint Commission PSC', waStateStroke: 'II', waStateCardiac: 'I', hasELVO: false, edVolume: 45000, helipad: 'Yes', ct24: 'Yes', uwPartner: true },
            { name: 'EvergreenHealth Medical Center', type: 'CSC', lat: 47.6534, lng: -122.2009, city: 'Kirkland', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'CSC', nationalCert: 'DNV CSC', waStateStroke: 'II', waStateCardiac: 'I', hasELVO: false, edVolume: 48000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },

            // === COMPREHENSIVE STROKE CENTERS (16) ===
            // *** = Washington State Level I Stroke + 24/7 ELVO (thrombectomy) capability
            { name: 'Harborview Medical Center', type: 'CSC', lat: 47.6052, lng: -122.3204, city: 'Seattle', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'CSC', nationalCert: 'Joint Commission CSC', waStateStroke: 'I', waStateCardiac: 'I', hasELVO: true, edVolume: 95000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Swedish Medical Center - Cherry Hill', type: 'CSC', lat: 47.6062, lng: -122.3321, city: 'Seattle', state: 'WA', affiliation: 'Competitor', strokeLevel: 'CSC', nationalCert: 'DNV CSC', waStateStroke: 'I', waStateCardiac: 'I', hasELVO: true, edVolume: 60000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Virginia Mason Medical Center', type: 'CSC', lat: 47.6101, lng: -122.3321, city: 'Seattle', state: 'WA', affiliation: 'Competitor', strokeLevel: 'CSC', nationalCert: 'CSC', waStateStroke: 'I', waStateCardiac: 'I', hasELVO: true, edVolume: 48000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Providence Sacred Heart Medical Center', type: 'CSC', lat: 47.6587, lng: -117.4260, city: 'Spokane', state: 'WA', affiliation: 'Competitor', strokeLevel: 'CSC', nationalCert: 'CSC', waStateStroke: 'I', waStateCardiac: 'I', hasELVO: true, edVolume: 70000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'MultiCare Tacoma General Hospital', type: 'CSC', lat: 47.2529, lng: -122.4443, city: 'Tacoma', state: 'WA', affiliation: 'Competitor', strokeLevel: 'CSC', nationalCert: 'DNV CSC', waStateStroke: 'I', waStateCardiac: 'I', hasELVO: true, edVolume: 56000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'St. Joseph Medical Center', type: 'CSC', lat: 47.2490, lng: -122.4410, city: 'Tacoma', state: 'WA', affiliation: 'Competitor', strokeLevel: 'CSC', nationalCert: 'CSC', waStateStroke: 'I', waStateCardiac: 'I', hasELVO: true, edVolume: 46000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Providence Regional Medical Center Everett', type: 'CSC', lat: 47.9790, lng: -122.2021, city: 'Everett', state: 'WA', affiliation: 'Competitor', strokeLevel: 'CSC', nationalCert: 'CSC', waStateStroke: 'II', waStateCardiac: 'I', hasELVO: true, edVolume: 76000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'PeaceHealth Southwest Medical Center', type: 'CSC', lat: 45.6387, lng: -122.5007, city: 'Vancouver', state: 'WA', affiliation: 'Competitor', strokeLevel: 'CSC', nationalCert: 'CSC', waStateStroke: 'I', waStateCardiac: 'I', hasELVO: false, edVolume: 67000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Swedish Medical Center - First Hill', type: 'CSC', lat: 47.6092, lng: -122.3224, city: 'Seattle', state: 'WA', affiliation: 'Competitor', strokeLevel: 'CSC', nationalCert: 'CSC', waStateStroke: 'II', waStateCardiac: 'II', hasELVO: false, edVolume: 64000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'UW Medical Center - Montlake', type: 'CSC', lat: 47.6505, lng: -122.3050, city: 'Seattle', state: 'WA', affiliation: 'UW Medicine', strokeLevel: 'CSC', nationalCert: 'CSC', waStateStroke: 'III', waStateCardiac: 'I', hasELVO: false, edVolume: 52000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Kadlec Regional Medical Center', type: 'CSC', lat: 46.2396, lng: -119.1372, city: 'Richland', state: 'WA', affiliation: 'Competitor', strokeLevel: 'CSC', nationalCert: 'CSC', waStateStroke: 'II', waStateCardiac: 'I', hasELVO: false, edVolume: 50000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Kootenai Health', type: 'CSC', lat: 47.6788, lng: -116.7805, city: 'Coeur d\'Alene', state: 'ID', affiliation: 'TBD', strokeLevel: 'CSC', edVolume: 54000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Providence St. Mary Medical Center', type: 'CSC', lat: 47.2529, lng: -122.4443, city: 'Walla Walla', state: 'WA', affiliation: 'Competitor', strokeLevel: 'CSC', edVolume: 24000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Alaska Regional Hospital', type: 'CSC', lat: 61.1508, lng: -149.9778, city: 'Anchorage', state: 'AK', affiliation: 'TBD', strokeLevel: 'CSC', edVolume: 48000, helipad: 'Yes', ct24: 'Yes', uwPartner: false },
            { name: 'Providence Alaska Medical Center', type: 'CSC', lat: 61.1941, lng: -149.8397, city: 'Anchorage', state: 'AK', affiliation: 'Competitor', strokeLevel: 'CSC', edVolume: 72000, helipad: 'Yes', ct24: 'Yes', uwPartner: false }
        ];

        // Initialize the map centered on Pacific Northwest
        const map = L.map('map').setView([47.6, -120.5], 7);

        // Add OpenStreetMap tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            maxZoom: 19
        }).addTo(map);

        // Add Harborview marker (special gold star) - REFERENCE POINT, always visible
        const harborviewIcon = L.divIcon({
            html: '<div style="background-color: gold; width: 20px; height: 20px; border-radius: 50%; border: 3px solid #333; display: flex; align-items: center; justify-content: center;"><span style="color: #333; font-weight: bold; font-size: 16px;">‚òÖ</span></div>',
            className: 'custom-div-icon',
            iconSize: [20, 20],
            iconAnchor: [10, 10]
        });

        const harborviewMarker = L.marker([HARBORVIEW.lat, HARBORVIEW.lng], { icon: harborviewIcon })
            .bindPopup(`<strong>${HARBORVIEW.name}</strong><br><span style="color: #999; font-style: italic;">Reference Point (Always Visible)</span><br>Distance rings are centered here<br>Level I Trauma & Comprehensive Stroke Center`)
            .addTo(map);

        // Add distance rings from Harborview
        const distanceRings = L.layerGroup();
        const ringDistances = [50, 100, 150, 200]; // miles
        const ringColors = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444'];

        ringDistances.forEach((distance, index) => {
            const radiusInMeters = distance * 1609.34; // Convert miles to meters
            L.circle([HARBORVIEW.lat, HARBORVIEW.lng], {
                color: ringColors[index],
                fillColor: ringColors[index],
                fillOpacity: 0.05,
                radius: radiusInMeters,
                weight: 2
            }).bindPopup(`${distance} mile radius from Harborview`).addTo(distanceRings);
        });
        distanceRings.addTo(map);

        // Function to calculate distance between two points (Haversine formula)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 3959; // Radius of Earth in miles
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                     Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                     Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Function to get marker color based on hospital type
        function getMarkerColor(type) {
            switch(type) {
                case 'CAH': return '#3b82f6'; // Blue
                case 'Acute': return '#6b7280'; // Gray
                case 'PSC': return '#ef4444'; // Red
                case 'CSC': return '#9333ea'; // Purple
                default: return '#6b7280';
            }
        }

        // Function to get label class based on hospital type
        function getLabelClass(type) {
            switch(type) {
                case 'CAH': return 'hospital-label-cah';
                case 'Acute': return 'hospital-label-acute';
                case 'PSC': return 'hospital-label-psc';
                case 'CSC': return 'hospital-label-csc';
                default: return 'hospital-label-acute';
            }
        }

        // Store all markers for filtering
        const markerLayers = {};

        // Add hospital markers
        hospitals.forEach(hospital => {
            const distance = calculateDistance(
                HARBORVIEW.lat, HARBORVIEW.lng,
                hospital.lat, hospital.lng
            );

            hospital.distanceToHMC = Math.round(distance);

            const color = getMarkerColor(hospital.type);
            const labelClass = getLabelClass(hospital.type);

            // Add gold border for UW Medicine partners
            const borderColor = hospital.uwPartner ? '#f59e0b' : '#333';
            const borderWidth = hospital.uwPartner ? '3px' : '2px';
            const partnerStar = hospital.uwPartner ? '<span style="position: absolute; top: -8px; right: -8px; color: #f59e0b; font-size: 14px;">‚òÖ</span>' : '';

            // Assign label priority for zoom-based visibility
            // High priority: CSC, PSC, UW Partners
            // Medium priority: Acute Care
            // Low priority: CAH
            let labelPriority = 'label-priority-low';
            if (hospital.type === 'CSC' || hospital.type === 'PSC' || hospital.uwPartner) {
                labelPriority = 'label-priority-high';
            } else if (hospital.type === 'Acute') {
                labelPriority = 'label-priority-medium';
            }

            // Create custom divIcon with label
            const customIcon = L.divIcon({
                html: `
                    <div style="position: relative;">
                        <div style="background-color: ${color}; width: 12px; height: 12px; border-radius: 50%; border: ${borderWidth} solid ${borderColor}; position: relative;">
                            ${partnerStar}
                        </div>
                        <div class="hospital-label ${labelClass} ${labelPriority} ${hospital.uwPartner ? 'uw-partner-label' : ''}" data-hospital-id="${hospital.name}" style="position: absolute; left: 16px; top: -6px; ${hospital.uwPartner ? 'font-weight: 700; color: #f59e0b; border-color: #f59e0b;' : ''}">${hospital.name}</div>
                    </div>
                `,
                className: 'custom-div-icon',
                iconSize: [12, 12],
                iconAnchor: [6, 6]
            });

            const uwPartnerBadge = hospital.uwPartner ? '<span style="background: #f59e0b; color: white; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; margin-left: 8px;">‚òÖ UW PARTNER</span>' : '';
            const elvoIndicator = hospital.hasELVO ? '<span style="background: #10b981; color: white; padding: 2px 6px; border-radius: 3px; font-size: 10px; font-weight: bold; margin-left: 4px;">24/7 ELVO</span>' : '';

            // Build certification display
            let certificationHTML = '';
            if (hospital.nationalCert || hospital.waStateStroke) {
                certificationHTML = `
                    <tr><td colspan="2" style="padding: 8px 0 4px 0; border-top: 1px solid #e5e7eb;"><strong>Stroke Center Designation:</strong></td></tr>
                    ${hospital.nationalCert ? `<tr><td style="padding: 3px 10px 3px 0; padding-left: 12px;">National Certification:</td><td style="padding: 3px 0;"><strong>${hospital.nationalCert}</strong>${elvoIndicator}</td></tr>` : ''}
                    ${hospital.waStateStroke ? `<tr><td style="padding: 3px 10px 3px 0; padding-left: 12px;">WA State Stroke Level:</td><td style="padding: 3px 0;"><strong>Level ${hospital.waStateStroke}</strong></td></tr>` : ''}
                    ${hospital.waStateCardiac ? `<tr><td style="padding: 3px 10px 3px 0; padding-left: 12px;">WA State Cardiac Level:</td><td style="padding: 3px 0;">Level ${hospital.waStateCardiac}</td></tr>` : ''}
                `;
            } else {
                certificationHTML = `<tr><td style="padding: 3px 10px 3px 0;"><strong>State Stroke Level:</strong></td><td style="padding: 3px 0;">${hospital.strokeLevel}</td></tr>`;
            }

            const marker = L.marker([hospital.lat, hospital.lng], { icon: customIcon })
                .bindPopup(`
                    <div style="min-width: 280px;">
                        <h3 style="margin: 0 0 10px 0; font-size: 16px; font-weight: bold;">${hospital.name}${uwPartnerBadge}</h3>
                        <table style="width: 100%; font-size: 13px;">
                            <tr><td style="padding: 3px 10px 3px 0;"><strong>Type:</strong></td><td style="padding: 3px 0;">${hospital.type}</td></tr>
                            <tr><td style="padding: 3px 10px 3px 0;"><strong>Location:</strong></td><td style="padding: 3px 0;">${hospital.city}, ${hospital.state}</td></tr>
                            <tr><td style="padding: 3px 10px 3px 0;"><strong>Distance to HMC:</strong></td><td style="padding: 3px 0;">${hospital.distanceToHMC} miles</td></tr>
                            ${hospital.uwPartner ? '<tr><td style="padding: 3px 10px 3px 0;"><strong>Network:</strong></td><td style="padding: 3px 0; color: #f59e0b; font-weight: bold;">UW Medicine Telestroke Partner</td></tr>' : ''}
                            ${certificationHTML}
                            <tr><td colspan="2" style="padding: 8px 0 4px 0; border-top: 1px solid #e5e7eb;"><strong>Operational Data:</strong></td></tr>
                            <tr><td style="padding: 3px 10px 3px 0; padding-left: 12px;">Annual ED Volume:</td><td style="padding: 3px 0;">${hospital.edVolume.toLocaleString()}</td></tr>
                            <tr><td style="padding: 3px 10px 3px 0; padding-left: 12px;">Helipad:</td><td style="padding: 3px 0;">${hospital.helipad}</td></tr>
                            <tr><td style="padding: 3px 10px 3px 0; padding-left: 12px;">24/7 CT:</td><td style="padding: 3px 0;">${hospital.ct24}</td></tr>
                        </table>
                    </div>
                `);

            // Store marker with metadata for filtering
            markerLayers[hospital.name] = {
                marker: marker,
                data: hospital,
                layer: L.layerGroup([marker])
            };

            marker.addTo(map);
        });

        // Update statistics
        function updateStatistics() {
            const visibleHospitals = hospitals.filter(h => {
                const layer = markerLayers[h.name];
                return layer && map.hasLayer(layer.marker);
            });

            const cahCount = visibleHospitals.filter(h => h.type === 'CAH').length;
            const acuteCount = visibleHospitals.filter(h => h.type === 'Acute').length;
            const pscCount = visibleHospitals.filter(h => h.type === 'PSC').length;
            const cscCount = visibleHospitals.filter(h => h.type === 'CSC').length;
            const uwPartnerCount = visibleHospitals.filter(h => h.uwPartner).length;

            // Coverage by distance
            const dist0to50 = visibleHospitals.filter(h => h.distanceToHMC <= 50).length;
            const dist50to100 = visibleHospitals.filter(h => h.distanceToHMC > 50 && h.distanceToHMC <= 100).length;
            const dist100to150 = visibleHospitals.filter(h => h.distanceToHMC > 100 && h.distanceToHMC <= 150).length;
            const dist150plus = visibleHospitals.filter(h => h.distanceToHMC > 150).length;

            const uwCoveragePct = visibleHospitals.length > 0 ? ((uwPartnerCount / visibleHospitals.length) * 100).toFixed(1) : 0;

            document.getElementById('total-count').textContent = visibleHospitals.length;
            document.getElementById('cah-count').textContent = cahCount;
            document.getElementById('acute-count').textContent = acuteCount;
            document.getElementById('psc-count').textContent = pscCount;
            document.getElementById('csc-count').textContent = cscCount;
            document.getElementById('uw-partner-count').textContent = uwPartnerCount;
            document.getElementById('uw-coverage-pct').textContent = `${uwCoveragePct}% of facilities`;

            document.getElementById('coverage-0-50').textContent = dist0to50;
            document.getElementById('coverage-50-100').textContent = dist50to100;
            document.getElementById('coverage-100-150').textContent = dist100to150;
            document.getElementById('coverage-150-plus').textContent = dist150plus;
        }

        // Search functionality
        function setupSearch() {
            const searchInput = document.getElementById('hospital-search');
            const searchResults = document.getElementById('search-results');

            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase().trim();

                if (query.length < 2) {
                    searchResults.classList.add('hidden');
                    return;
                }

                const matches = hospitals.filter(h =>
                    h.name.toLowerCase().includes(query) ||
                    h.city.toLowerCase().includes(query)
                ).slice(0, 10); // Limit to 10 results

                if (matches.length === 0) {
                    searchResults.innerHTML = '<div class="p-2 text-gray-500">No hospitals found</div>';
                    searchResults.classList.remove('hidden');
                    return;
                }

                searchResults.innerHTML = matches.map(h => `
                    <div class="p-2 hover:bg-gray-100 cursor-pointer border-b border-gray-200"
                         onclick="zoomToHospital('${h.name.replace(/'/g, "\\'")}')">
                        <div class="font-semibold ${h.uwPartner ? 'text-amber-600' : ''}">${h.uwPartner ? '‚òÖ ' : ''}${h.name}</div>
                        <div class="text-gray-600">${h.city}, ${h.state} ‚Ä¢ ${h.type}</div>
                    </div>
                `).join('');

                searchResults.classList.remove('hidden');
            });
        }

        // Zoom to specific hospital
        function zoomToHospital(hospitalName) {
            const hospital = hospitals.find(h => h.name === hospitalName);
            if (hospital) {
                map.setView([hospital.lat, hospital.lng], 10);
                const layer = markerLayers[hospital.name];
                if (layer && layer.marker) {
                    layer.marker.openPopup();
                }
                document.getElementById('search-results').classList.add('hidden');
                document.getElementById('hospital-search').value = '';
            }
        }

        // Quick action buttons
        function showUWPartnersOnly() {
            // Partnership filters
            document.getElementById('filter-uw-partners').checked = true;
            document.getElementById('filter-non-partners').checked = false;

            // Enable ALL hospital types (so all UW partners show regardless of type)
            document.getElementById('filter-cah').checked = true;
            document.getElementById('filter-acute').checked = true;
            document.getElementById('filter-psc').checked = true;
            document.getElementById('filter-csc').checked = true;

            // Enable ALL distances (so all UW partners show regardless of distance)
            document.getElementById('filter-0-50').checked = true;
            document.getElementById('filter-50-100').checked = true;
            document.getElementById('filter-100-150').checked = true;
            document.getElementById('filter-150-plus').checked = true;

            applyFilters();
        }

        function showNonPartnersOnly() {
            // Partnership filters
            document.getElementById('filter-uw-partners').checked = false;
            document.getElementById('filter-non-partners').checked = true;

            // Enable ALL hospital types (so all non-partners show regardless of type)
            document.getElementById('filter-cah').checked = true;
            document.getElementById('filter-acute').checked = true;
            document.getElementById('filter-psc').checked = true;
            document.getElementById('filter-csc').checked = true;

            // Enable ALL distances (so all non-partners show regardless of distance)
            document.getElementById('filter-0-50').checked = true;
            document.getElementById('filter-50-100').checked = true;
            document.getElementById('filter-100-150').checked = true;
            document.getElementById('filter-150-plus').checked = true;

            applyFilters();
        }

        function showCSCPSCOnly() {
            // Enable both UW partners and non-partners
            document.getElementById('filter-uw-partners').checked = true;
            document.getElementById('filter-non-partners').checked = true;

            // Only stroke centers
            document.getElementById('filter-cah').checked = false;
            document.getElementById('filter-acute').checked = false;
            document.getElementById('filter-psc').checked = true;
            document.getElementById('filter-csc').checked = true;

            // Enable ALL distances
            document.getElementById('filter-0-50').checked = true;
            document.getElementById('filter-50-100').checked = true;
            document.getElementById('filter-100-150').checked = true;
            document.getElementById('filter-150-plus').checked = true;

            applyFilters();
        }

        function showCAHOnly() {
            // Enable both UW partners and non-partners
            document.getElementById('filter-uw-partners').checked = true;
            document.getElementById('filter-non-partners').checked = true;

            // Only CAH
            document.getElementById('filter-cah').checked = true;
            document.getElementById('filter-acute').checked = false;
            document.getElementById('filter-psc').checked = false;
            document.getElementById('filter-csc').checked = false;

            // Enable ALL distances
            document.getElementById('filter-0-50').checked = true;
            document.getElementById('filter-50-100').checked = true;
            document.getElementById('filter-100-150').checked = true;
            document.getElementById('filter-150-plus').checked = true;

            applyFilters();
        }

        // Export to CSV
        function exportToCSV() {
            const visibleHospitals = hospitals.filter(h => {
                const layer = markerLayers[h.name];
                return layer && map.hasLayer(layer.marker);
            });

            // CSV headers
            const headers = [
                'Hospital Name',
                'City',
                'State',
                'Type',
                'UW Medicine Partner',
                'State Stroke Level',
                'Distance to HMC (miles)',
                'Annual ED Volume',
                'Helipad',
                '24/7 CT',
                'Latitude',
                'Longitude'
            ];

            // CSV rows
            const rows = visibleHospitals.map(h => [
                h.name,
                h.city,
                h.state,
                h.type,
                h.uwPartner ? 'Yes' : 'No',
                h.strokeLevel,
                h.distanceToHMC,
                h.edVolume,
                h.helipad,
                h.ct24,
                h.lat,
                h.lng
            ]);

            // Combine headers and rows
            const csvContent = [
                headers.join(','),
                ...rows.map(row => row.map(cell => `"${cell}"`).join(','))
            ].join('\n');

            // Download
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            const timestamp = new Date().toISOString().split('T')[0];
            link.setAttribute('href', url);
            link.setAttribute('download', `telestroke-network-${timestamp}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Label display mode handler
        function updateLabelDisplay() {
            const mode = document.getElementById('label-mode').value;
            const zoom = map.getZoom();
            const labels = document.querySelectorAll('.hospital-label');

            labels.forEach(label => {
                const isUWPartner = label.classList.contains('uw-partner-label');
                const isPriorityHigh = label.classList.contains('label-priority-high');
                const isPriorityMedium = label.classList.contains('label-priority-medium');

                switch(mode) {
                    case 'hover':
                        // Labels only show on hover (handled by CSS)
                        label.style.display = 'none';
                        label.style.opacity = '0';
                        break;

                    case 'zoom':
                        // Smart zoom-based display
                        if (zoom >= 9) {
                            // High zoom - show all labels
                            label.style.display = 'block';
                            label.style.opacity = '1';
                        } else if (zoom >= 8) {
                            // Medium zoom - show high and medium priority
                            if (isPriorityHigh || isPriorityMedium) {
                                label.style.display = 'block';
                                label.style.opacity = '1';
                            } else {
                                label.style.display = 'none';
                                label.style.opacity = '0';
                            }
                        } else {
                            // Low zoom - only high priority (CSC, PSC, UW Partners)
                            if (isPriorityHigh) {
                                label.style.display = 'block';
                                label.style.opacity = '1';
                            } else {
                                label.style.display = 'none';
                                label.style.opacity = '0';
                            }
                        }
                        break;

                    case 'always':
                        // Show all labels always
                        label.style.display = 'block';
                        label.style.opacity = '1';
                        break;

                    case 'partners':
                        // Only show UW partner labels
                        if (isUWPartner) {
                            label.style.display = 'block';
                            label.style.opacity = '1';
                        } else {
                            label.style.display = 'none';
                            label.style.opacity = '0';
                        }
                        break;

                    case 'none':
                        // Hide all labels
                        label.style.display = 'none';
                        label.style.opacity = '0';
                        break;
                }
            });
        }

        // Filter function
        function applyFilters() {
            const uwPartnerFilter = document.getElementById('filter-uw-partners').checked;
            const nonPartnerFilter = document.getElementById('filter-non-partners').checked;

            const typeFilters = {
                CAH: document.getElementById('filter-cah').checked,
                Acute: document.getElementById('filter-acute').checked,
                PSC: document.getElementById('filter-psc').checked,
                CSC: document.getElementById('filter-csc').checked
            };

            const distanceFilters = {
                '0-50': document.getElementById('filter-0-50').checked,
                '50-100': document.getElementById('filter-50-100').checked,
                '100-150': document.getElementById('filter-100-150').checked,
                '150+': document.getElementById('filter-150-plus').checked
            };

            let filteredCount = 0;
            let visibleCount = 0;

            hospitals.forEach(hospital => {
                const layer = markerLayers[hospital.name];
                if (!layer) {
                    console.warn(`Hospital not found in markerLayers: ${hospital.name}`);
                    return;
                }

                let show = true;

                // UW Partner filter
                if (hospital.uwPartner && !uwPartnerFilter) {
                    show = false;
                }
                if (!hospital.uwPartner && !nonPartnerFilter) {
                    show = false;
                }

                // Type filter
                if (!typeFilters[hospital.type]) {
                    show = false;
                }

                // Distance filter
                const dist = hospital.distanceToHMC;
                let distanceMatch = false;
                if (dist <= 50 && distanceFilters['0-50']) distanceMatch = true;
                if (dist > 50 && dist <= 100 && distanceFilters['50-100']) distanceMatch = true;
                if (dist > 100 && dist <= 150 && distanceFilters['100-150']) distanceMatch = true;
                if (dist > 150 && distanceFilters['150+']) distanceMatch = true;

                if (!distanceMatch) {
                    show = false;
                }

                // Show/hide marker
                if (show) {
                    if (!map.hasLayer(layer.marker)) {
                        layer.marker.addTo(map);
                    }
                    visibleCount++;
                } else {
                    if (map.hasLayer(layer.marker)) {
                        map.removeLayer(layer.marker);
                    }
                    filteredCount++;
                }
            });

            // Debug logging to help identify filter issues
            console.log(`Filters applied: ${visibleCount} visible, ${filteredCount} hidden`);
            if (visibleCount === 0 && filteredCount === 0) {
                console.error('WARNING: No hospitals processed by filters! Check markerLayers.');
            }

            updateStatistics();
            updateLabelDisplay(); // Update labels after filtering
        }

        // Reset filters function
        function resetFilters() {
            document.getElementById('filter-uw-partners').checked = true;
            document.getElementById('filter-non-partners').checked = true;
            document.getElementById('filter-cah').checked = true;
            document.getElementById('filter-acute').checked = true;
            document.getElementById('filter-psc').checked = true;
            document.getElementById('filter-csc').checked = true;
            document.getElementById('filter-0-50').checked = true;
            document.getElementById('filter-50-100').checked = true;
            document.getElementById('filter-100-150').checked = true;
            document.getElementById('filter-150-plus').checked = true;
            document.getElementById('label-mode').value = 'hover';
            document.getElementById('toggle-rings').checked = true;

            if (map.hasLayer(distanceRings)) {
                // already on map
            } else {
                distanceRings.addTo(map);
            }

            applyFilters();
        }

        // Add event listeners to all filters
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                if (checkbox.id === 'toggle-rings') {
                    if (checkbox.checked) {
                        distanceRings.addTo(map);
                    } else {
                        map.removeLayer(distanceRings);
                    }
                } else {
                    applyFilters();
                }
            });
        });

        // Label mode selector event listener
        document.getElementById('label-mode').addEventListener('change', updateLabelDisplay);

        // Map zoom event listener for zoom-based labels
        map.on('zoomend', () => {
            const mode = document.getElementById('label-mode').value;
            if (mode === 'zoom') {
                updateLabelDisplay();
            }
        });

        // Initial setup
        applyFilters(); // CRITICAL: Apply filters on page load to ensure consistent state
        updateStatistics();
        updateLabelDisplay();
        setupSearch();

        // Log hospital count for verification
        console.log('Total hospitals loaded:', hospitals.length);
        console.log('CAH:', hospitals.filter(h => h.type === 'CAH').length);
        console.log('Acute:', hospitals.filter(h => h.type === 'Acute').length);
        console.log('PSC:', hospitals.filter(h => h.type === 'PSC').length);
        console.log('CSC:', hospitals.filter(h => h.type === 'CSC').length);
    </script>
</body>
</html>
